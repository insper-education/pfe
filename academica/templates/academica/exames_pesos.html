{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 3 de Dezembro de 2023
{% endcomment %}

{% block head %}
  {% load static %}
  {% load l10n %}
  <style>
    th, td {
      padding-left: 4px;
      padding-right: 4px;
    }
    ul {
      margin: 4px;
      padding: 0px 0px 0px 1.0em;
    }
  </style>

{% endblock %}

{% block content %}

  <span class="titulo">Exames e Pesos</span>

  <div class="atualizar">

    <table id="ExamesPesosTable">
      <thead>
        <tr>
          <th onclick="w3.sortHTML('#EstudantesTable', '.item', 'td:nth-child(1)')" style="cursor:pointer" class="text-center">Semestre</th>
          <th onclick="w3.sortHTML('#EstudantesTable', '.item', 'td:nth-child(2)')" style="cursor:pointer" class="text-center">Exames</th>
          <th onclick="w3.sortHTML('#EstudantesTable', '.item', 'td:nth-child(3)')" style="cursor:pointer" class="text-center">Peso</th>
        </tr>
      </thead>
      <tbody>
        {% for semestre, composicoes in semestres.items %}
          <script> var peso = 0; </script>
          <tr class="item">
            <td class="text-center"> {{semestre}}</td>
            <td>
              <ul>
              {% for composicao in composicoes %}
                <li>{{composicao.exame}} ({{composicao.data_inicial|date:"d/m/Y"}} a 
                       {% if composicao.data_final%}{{composicao.data_final|date:"d/m/Y"}}{% else %}atualmente{% endif %}):
                {% for peso in composicao.peso_set.all %} 
                  {% if peso.objetivo %}[{{peso.objetivo.sigla}}{% else %}[Única{% endif %}={{peso.peso|floatformat:2}}] 
                  {% if peso.peso %}
                    <script> peso += {{peso.peso|unlocalize}}; </script>
                  {% endif %}
                {% endfor %}</li>
              {% endfor %}
              </ul>
            </td>
            <td><span id="peso{{forloop.counter0}}">TO DO</span></td>
          </tr>
          <script> document.getElementById("peso{{forloop.counter0}}").innerHTML = peso.toFixed(2); </script>
        {% endfor %}
      </tbody>
    </table>
    <br>
    <small>Terminar o semestre até junho e iniciar a partir de agosto.</small>
  
{% endblock %}
