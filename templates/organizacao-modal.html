{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 8 de Abril de 2021
{% endcomment %}

<script>

  var proposta;
  var url;

  $(document).on("click", ".link-organizacao", function (e) {
    e.preventDefault();
    var $popup = $("#popup");
    proposta = $(this).data("proposta");
    url = $(this).data("url");

    $(".modal-content", $popup).load(url, function () {
      $popup.modal("show");
    });
  });

</script>


<!-- Modal -->
<div class="modal fade" id="popup" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div id="modal-content" class="modal-content">
    </div>
  </div>
</div>


<script>

  function atualiza_organizacao(e) {
    
    if (!$('form')[0].checkValidity()) {
        $('form').find('input[type="submit"]').click();
        return false;
    }

    var organizacao_id = $('#organizacao').val();

    $.ajax({
        type: "POST",
        url: url,
        data: {
            'organizacao_id': organizacao_id,
            'csrfmiddlewaretoken': '{{ csrf_token }}',
        },
        success: function(response){
            if (response.atualizado) {

              $('#organizacao_nome').html(response.organizacao);  // Para organizacao completo

              href = "../../organizacoes/organizacao_completo/"+response.organizacao_id;
              novo = "<a href='"+href+"'>"+response.organizacao+"</a>";
              $('#proposta'+response.proposta).html(novo);  // Só para tabela
              $('#organizacao_link').html(response.organizacao);  // Para organizacao completo
              $('#organizacao_link').attr("href", href); // Para organizacao completo
              $('#organizacao_endereco').html(response.organizacao_endereco);  // Para organizacao completo

              $('#organizacao_website').html(response.organizacao_website); // Para organizacao completo
              $('#organizacao_website').attr("href", response.organizacao_website); // Para organizacao completo

              $("#logotipo").attr("src", response.organizacao_logotipo_url);
              $("#logotipo").attr("alt", response.organizacao_sigla);

              $('.pulsar').css("animation-play-state", "paused"); // Stop pulsar animation

            }
            else {
              console.log("Erro: Valor não atualizado.");
            }
        },
        error: function (request, status, error) {
          {% if user.tipo_de_usuario == 4 %} 
            alert(request.responseText);
            jQuery("body").html(request.responseText.replace(/\n/g,"<br>"));
            console.log('error'+request.responseText);
          {% else %}
            jQuery("body").html("Erro no servidor. Por favor contactar: <a href='mailto:lpsoares@insper.edu.br'>lpsoares@insper.edu.br</a>");
          {% endif %}
        }
    });

  }
</script> 