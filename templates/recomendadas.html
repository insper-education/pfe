{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 12 de Novembro de 2020
{% endcomment %}

{% if proposta %}

  {% if proposta.recomendada_set.all or editavel %}
    <hr>
    <h4>
    <h4 style="margin-bottom: 0px;">
      Disciplina(s) Recomendada(s)
      {% if editavel %}
        <small>
          <a
            data-proposta='{{proposta.id}}'
            class="link-disciplina"
            href="{% url 'link_disciplina' proposta.id %}"
            data-url="{% url 'link_disciplina' proposta.id %}"
            >&#10133;</a>
        </small>
      {% endif %}
    </h4>
    <small>Disciplinas recomendadas que estudantes tenham ou estejam cursando para aplicar na proposta</small><br>
    
    <table id="disciplinas_recomendadas" style="margin-top: 10px;">
      <tr>
        <th>
          Nome da Disciplina
        </th>
      </tr>
      {% for rec in proposta.recomendada_set.all %}
        <tr id="disciplina{{rec.disciplina.id}}"><td>
            {{rec.disciplina.nome}}
            {% if editavel %}
              <div class="esconder" style="float:right;">
                &nbsp;
                <a onclick="event.preventDefault(); remove_disciplina($(this));"
                   data-disciplina='{{rec.disciplina.id}}'
                   data-proposta='{{proposta.id}}'>
                  <i class="far fa-trash-alt"></i>
                </a>
              </div>
            {% endif %}
        </td></tr>
      {% endfor %}
    </table>

    {% if editavel %}
      {% include "disciplina-modal.html" %}
    {% endif %}

  {% endif %}
  <br>

  <script>

    function remove_disciplina(aqui) {
      disciplina = aqui.data('disciplina');
      proposta = aqui.data('proposta');

      $.ajax({
          type: "POST",
          url: '{% url "remover_disciplina" %}',
          data: {
              'disciplina_id': disciplina,
              'proposta_id': proposta,
              'csrfmiddlewaretoken': '{{ csrf_token }}',
          },
          success: function(response){
            $('#disciplina'+disciplina).remove();
          },
          error: function (request, status, error) {
            {% if user.tipo_de_usuario == 4 %} 
              alert(request.responseText);
              jQuery("body").html(request.responseText.replace(/\n/g,"<br>"));
              console.log('error'+request.responseText);
            {% else %}
              jQuery("body").html("Erro no servidor do PFE. Por favor contactar: <a href='mailto:lpsoares@insper.edu.br'>lpsoares@insper.edu.br</a>");
            {% endif %}
          }
      });


    }
  </script>

{% endif %}