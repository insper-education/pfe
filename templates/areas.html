{% comment %}
  Desenvolvido para o Projeto Final de Engenharia
  Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
  Data: 21 de Abril de 2020
{% endcomment %}

{% load linguas %}

<style>
  .sem_b, .sem_b td {
    border: none;
    font-size: 14px;
  }
  .ar_in {
    padding: 0px 3px 0px 3px;
  }
  .ar_la {
    line-height:0.6em;
    margin-bottom: 0px;
  }

  #bordar_areas {
    display: inline-block;
    border-radius: 8px;
    border: 2px solid #636DD1;
    padding: 6px;
    width: fit-content;
    margin: 0.1em 0px 0.5em 0px;  
  }
  
  .card {
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 1rem;
    border: none;
    max-width: 700px;
  }

  .card-header {
    background-color: #636DD1;
    color: white;
    padding: 10px 15px;
    border-radius: 8px 8px 0 0;
  }

  .card-body {
    padding: 15px;
  }

  .checkbox-label {
    align-items: center;
    margin-left: 10px;
    display: inline-flex;
  }

  .checkbox-label input {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    border-radius: 4px;
    border: 1px solid #ced4da;
    padding: 5px;
    resize: vertical;
  }
</style>

{% if areas_de_interesse_possiveis or areas_de_interesse_selecionadas %}

  {% if com_borda %}
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">
          <i class="fas fa-heart mr-2"></i>
          <label for="titulo_areas" style="line-height:0.6em;"><b>
            {% lng "√Åreas de Interesse" "Areas of Interest" %}
          </b></label>
          {% if titulo_areas %}
            <span class="checkbox-label">
              <input type="checkbox" id="titulo_areas" value="{{area.titulo}}"
               {% if tudo_ligado %}checked{% endif %}
               {% if vencido %}disabled{% endif %}>
            </span>
          {% endif %}
      </h6>
    </div>
    <div class="card-body">
  {% endif %}

  <table class="sem_b">
    <tbody>
      {% for area in areas_de_interesse_possiveis %}
        <tr><td class="ar_in">
                <input style="position: relative; top: 2px;" type="checkbox" name="selection" id="{{area.id}}" value="{{area.titulo}}" class="filtra_area"
                {% if tudo_ligado %}
                    checked
                {% else %}
                    {% for a in areas_de_interesse_selecionadas %}
                      {% if area == a.area %}checked{% endif %}
                    {% endfor %}
                {% endif %}
                {% if vencido %}disabled{% endif %}>
            </td>
            <td class="ar_in"
                {% if area.descricao %}
                    data-toggle="tooltip" data-html="true" animation="true" title="{{area.descricao}}"
                {% endif %}
                >
                <label for="{{area.id}}" class="ar_la">
                  {% lng area.titulo area.titulo_en %}
                </label>
            </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% if not com_borda %}
      <div style="height:8px;font-size:8px;">&nbsp;</div>
  {% endif %}
    
  {% if not not_outras %}
    <label style="display: inline-block; vertical-align: top; font-size: 14px;" for="outras">
      {% lng "Outras:" "Others:" %}
    </label> 
    <textarea type="text" cols="29" maxlength="128" id="outras" name="outras" wrap="soft"
    {% if vencido %}disabled{% endif %}
    >{% for a in areas_de_interesse_selecionadas %}{% if a.outras %}{{a.outras}}{% endif %}{% endfor %}</textarea>
  {% endif %}

  {% if com_borda %}
      </div>
    </div>
  {% endif %}

  {% if titulo_areas %}

    <script>

      var filterList = $("input.filtra_area[type=checkbox]");

      function atualiza_colunas() {

          var verdade = true;
          filterList.each(function(i, el) {
              if(!($(el)[0].checked)) {
                verdade = false;
                return;
              } 
          });
          if(verdade) {
              $("#titulo_areas").prop("checked", true);
              $("#titulo_areas").prop("indeterminate", false);
              return;
          }
          
          var verdade = false;
          filterList.each(function(i, el) {
              if($(el)[0].checked) {
                verdade = true;
                return;
              } 
          });
          if(!verdade) {
              $("#titulo_areas").prop("checked", false);
              $("#titulo_areas").prop("indeterminate", false);
              return;
          }

          $("#titulo_areas").prop("indeterminate", true);

      }

      atualiza_colunas();

      $(".filtra_area").change(function() {
          atualiza_colunas();
      });

      $("#titulo_areas").change(function() {
          if( $("#titulo_areas").is(":checked") ) {
              filterList.each(function(i, el) {
                  $(el).prop("checked", true).change();
              });
          } else {
              filterList.each(function(i, el) {
                  $(el).prop("checked", false).change();
              });
          }
      });

    </script>

  {% endif %}  

{% endif %}
