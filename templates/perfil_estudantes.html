{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 12 de Novembro de 2020
{% endcomment %}

<style>
  .obs {
    font-size: 12px;
    display: block;
  }
</style>

{% if proposta %}
  <h5 style="margin-bottom: 0px;">Perfil de Estudantes Esperados</h5>
  <small class="obs">Cada linha representa uma vaga que idealmente deve ser preenchida por um estudante dos cursos marcados</small>
  <table>
    <thead>
      <tr style="background-color: #EEEEEE;">
        <th style="text-align:center;"></th>
        {% for curso in cursos %}
          {% if curso.curso_do_insper %}
            <th style="text-align:center; width:138px;">
              {{curso.nome}}
              {% if editavel %}<input type="checkbox" id="alunos{{curso.sigla_curta}}">{% endif %}
            </th>
          {% endif %}
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      <tr> {% comment %} NAO EH A FORMA MAIS ELEGANTE MAS FUNCIONA POR ENQUANTO {% endcomment %}
        <td style="background-color: #EEEEEE; text-align:center; writing-mode: vertical-lr;" rowspan="4">Estudantes</td>
        {% for curso in cursos %}
          {% if curso.curso_do_insper %}
          <td style="text-align:center;">
            {% if editavel %}
                <label style="line-height:0.6em; "><input style="vertical-align: middle;" class="alunos" type="checkbox" id="alunos{{curso.sigla_curta}}1" name="alunos{{curso.sigla_curta}}1" value="{{curso.sigla_curta}}1" 
                {% if curso in proposta.perfil1.all %}checked{% endif %}></label>
            {% else %}
              {% if  curso in proposta.perfil1.all %}&#x2713;{% endif %}
            {% endif %}
          </td>
          {% endif %}
        {% endfor %}
      </tr>
      <tr>
        {% for curso in cursos %}
          {% if curso.curso_do_insper %}
          <td style="text-align:center;">
            {% if editavel %}
                <label style="line-height:0.6em;"><input style="vertical-align: middle;" class="alunos" type="checkbox" id="alunos{{curso.sigla_curta}}2" name="alunos{{curso.sigla_curta}}2" value="{{curso.sigla_curta}}2" 
                {% if curso in proposta.perfil2.all %}checked{% endif %}></label>
            {% else %}
              {% if  curso in proposta.perfil2.all %}&#x2713;{% endif %}
            {% endif %}
          </td>
          {% endif %}
        {% endfor %}
      </tr>
      <tr>
        {% for curso in cursos %}
          {% if curso.curso_do_insper %}
          <td style="text-align:center;">
            {% if editavel %}
                <label style="line-height:0.6em;"><input style="vertical-align: middle;" class="alunos" type="checkbox" id="alunos{{curso.sigla_curta}}3" name="alunos{{curso.sigla_curta}}3" value="{{curso.sigla_curta}}3" 
                {% if curso in proposta.perfil3.all %}checked{% endif %}></label>
            {% else %}
              {% if  curso in proposta.perfil3.all %}&#x2713;{% endif %}
            {% endif %}
          </td>
          {% endif %}
        {% endfor %}
      </tr>
      <tr>
        {% for curso in cursos %}
        {% if curso.curso_do_insper %}
        <td style="text-align:center;">
          {% if editavel %}
              <label style="line-height:0.6em;"><input style="vertical-align: middle;" class="alunos" type="checkbox" id="alunos{{curso.sigla_curta}}4" name="alunos{{curso.sigla_curta}}4" value="{{curso.sigla_curta}}4" 
              {% if curso in proposta.perfil4.all %}checked{% endif %}></label>
          {% else %}
            {% if  curso in proposta.perfil4.all %}&#x2713;{% endif %}
          {% endif %}
        </td>
        {% endif %}
      {% endfor %}
      </tr>
    </tbody>
  </table>

  {% if editavel %}
    <script>

      function atualiza_colunas() {

        if( $("#alunosC1").is(":checked") && $("#alunosC2").is(":checked") && $("#alunosC3").is(":checked") && $("#alunosC4").is(":checked") ) {
          $("#alunosC").prop("checked", true); 
          $("#alunosC").prop("indeterminate", false);
        } else if( (! $("#alunosC1").is(":checked")) && (! $("#alunosC2").is(":checked")) && (! $("#alunosC3").is(":checked")) && (! $("#alunosC4").is(":checked")) ) {
          $("#alunosC").prop("checked", false); 
          $("#alunosC").prop("indeterminate", false);
        } else {
          $("#alunosC").prop("indeterminate", true);
        }

        if( $("#alunosM1").is(":checked") && $("#alunosM2").is(":checked") && $("#alunosM3").is(":checked") && $("#alunosM4").is(":checked") ) {
          $("#alunosM").prop("checked", true); 
          $("#alunosM").prop("indeterminate", false);
        } else if( (! $("#alunosM1").is(":checked")) && (! $("#alunosM2").is(":checked")) && (! $("#alunosM3").is(":checked")) && (! $("#alunosM4").is(":checked")) ) {
          $("#alunosM").prop("checked", false); 
          $("#alunosM").prop("indeterminate", false);
        } else {
          $("#alunosM").prop("indeterminate", true);
        }

        if( $("#alunosX1").is(":checked") && $("#alunosX2").is(":checked") && $("#alunosX3").is(":checked") && $("#alunosX4").is(":checked") ) {
          $("#alunosX").prop("checked", true); 
          $("#alunosX").prop("indeterminate", false);
        } else if( (! $("#alunosX1").is(":checked")) && (! $("#alunosX2").is(":checked")) && (! $("#alunosX3").is(":checked")) && (! $("#alunosX4").is(":checked")) ) {
          $("#alunosX").prop("checked", false);
          $("#alunosX").prop("indeterminate", false);
        } else {
          $("#alunosX").prop("indeterminate", true);
        }

        if( $("#alunosB1").is(":checked") && $("#alunosB2").is(":checked") && $("#alunosB3").is(":checked") && $("#alunosB4").is(":checked") ) {
          $("#alunosB").prop("checked", true); 
          $("#alunosB").prop("indeterminate", false);
        } else if( (! $("#alunosB1").is(":checked")) && (! $("#alunosB2").is(":checked")) && (! $("#alunosB3").is(":checked")) && (! $("#alunosB4").is(":checked")) ) {
          $("#alunosB").prop("checked", false);
          $("#alunosB").prop("indeterminate", false);
        } else {
          $("#alunosB").prop("indeterminate", true);
        }

      }

      atualiza_colunas();

      $(".alunos").change(function() {
        atualiza_colunas();
      });

      $("#alunosC").change(function() {
        if( $("#alunosC").is(":checked") ) {
          $("#alunosC1").prop("checked", true).change();;
          $("#alunosC2").prop("checked", true).change();;
          $("#alunosC3").prop("checked", true).change();;
          $("#alunosC4").prop("checked", true).change();;
        } else {
          $("#alunosC1").prop("checked", false).change();;
          $("#alunosC2").prop("checked", false).change();;
          $("#alunosC3").prop("checked", false).change();;
          $("#alunosC4").prop("checked", false).change();;
        }
      });

      $('#alunosM').change(function() {
        if( $("#alunosM").is(":checked") ) {
          $("#alunosM1").prop("checked", true).change();;
          $("#alunosM2").prop("checked", true).change();;
          $("#alunosM3").prop("checked", true).change();;
          $("#alunosM4").prop("checked", true).change();;
        } else {
          $("#alunosM1").prop("checked", false).change();;
          $("#alunosM2").prop("checked", false).change();;
          $("#alunosM3").prop("checked", false).change();;
          $("#alunosM4").prop("checked", false).change();;
        }
      });

      $('#alunosX').change(function() {
        if( $("#alunosX").is(":checked") ) {
          $("#alunosX1").prop("checked", true).change();;
          $("#alunosX2").prop("checked", true).change();;
          $("#alunosX3").prop("checked", true).change();;
          $("#alunosX4").prop("checked", true).change();;
        } else {
          $("#alunosX1").prop("checked", false).change();;
          $("#alunosX2").prop("checked", false).change();;
          $("#alunosX3").prop("checked", false).change();;
          $("#alunosX4").prop("checked", false).change();;
        }
      });

      $('#alunosB').change(function() {
        if( $("#alunosB").is(":checked") ) {
          $("#alunosB1").prop("checked", true).change();;
          $("#alunosB2").prop("checked", true).change();;
          $("#alunosB3").prop("checked", true).change();;
          $("#alunosB4").prop("checked", true).change();;
        } else {
          $("#alunosB1").prop("checked", false).change();;
          $("#alunosB2").prop("checked", false).change();;
          $("#alunosB3").prop("checked", false).change();;
          $("#alunosB4").prop("checked", false).change();;
        }
      });

    </script>
  {% endif %}

{% else %}

    <strong>Não foi possível carregar dados da Proposta!</strong>

{% endif %}