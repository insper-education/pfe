{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 23 de Maio de 2019
{% endcomment %}

{% block head %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://www.w3schools.com/lib/w3.js"></script>
  <script src="https://www.chartjs.org/samples/latest/utils.js"></script>

  <script>
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  {% load static %}
  <script src="{% static 'js/Chart.min.js' %}"></script>
  
{% endblock %}

{% block content %}
    <h3>Alunos se Inscrevendo</h3>
    <strong>Número Total de Alunos se Inscrevendo:</strong> {{ num_alunos }}

    {% if alunos_list %}
        <table id="AlunosTable">
          <tr>
              <th class="text-center">C</th>
              <th onclick="w3.sortHTML('#AlunosTable', '.item', 'td:nth-child(2)')" style="cursor:pointer" class="text-center">Nome do Aluno</th>
              <th onclick="w3.sortHTML('#AlunosTable', '.item', 'td:nth-child(3)')" style="cursor:pointer" class="text-center">Curso</th>
          </tr>
          {% for aluno in alunos_list %} 
          <tr class="item">
            <td class="{% if aluno.opcao_set.all.count >= 5 %}text-success{% else %}text-danger{% endif %}">&#9673; </td>
            <td><a href="{% url 'aluno' aluno.id %}" data-toggle="tooltip" data-html="true" animation="true" title="
              {% for opcao in aluno.opcao_set.all %}
                <b>#{{opcao.prioridade}}:</b>
                  {% if aluno.alocado == opcao.projeto %}
                    <u>
                  {% endif %}
                {{opcao.projeto.titulo}} ({{opcao.projeto.empresa.nome_empresa}})
                  {% if aluno.alocado == opcao.projeto %}
                    </u>
                  {% endif %}
                <br>
              {% endfor %}
            ">
              {{aluno.user.first_name}}&nbsp;{{aluno.user.last_name}}
            </a></td>
            <td class="{% if aluno.curso == 'C' %}text-success{% elif aluno.curso == 'M' %}text-danger{% else %}text-warning{% endif %}">
              {{ aluno.get_curso_display }}
            </td>
          </tr>
          {% endfor %}
        </table>
        <br>
    {% else %}
      <p>Não existem alunos disponíveis.</p>
    {% endif %}
    
    <text class="text-success">&#9673;</text>Aluno já selecionou projetos [{{inscritos}}]<br>
    <text class="text-danger">&#9673;</text>Aluno ainda precisa selecionar projetos [{{ninscritos}}]<br>
    <br>


    <div id="canvas-holder" style="width:450px;height:250px">
        <canvas id="chart-area"></canvas>
      </div>
      <script>

        var config = {
          type: 'pie',
          data: {
            datasets: [{
              data: [
                {{ num_alunos_comp }},
                {{ num_alunos_mec }},
                {{ num_alunos_mxt }},
              ],
              backgroundColor: [
                window.chartColors.green,
                window.chartColors.red,
                window.chartColors.yellow,
              ],
              label: 'Proporção entre alunos'
            }],
            labels: [
              'Computação',
              'Mecânica',
              'Mecatrônica',
            ]
          },
          options: {
            responsive: true,
            title: {
                  display: true,
                  text: 'Proporção entre alunos',
                  position: 'top'
              },
          }
        };
    
        window.onload = function() {
          var ctx = document.getElementById('chart-area').getContext('2d');
          window.myPie = new Chart(ctx, config);
        };
      
      </script>

{% endblock %}