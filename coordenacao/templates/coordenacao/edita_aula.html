{% comment %}
  Desenvolvido para o Projeto Final de Engenharia
  Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
  Data: 20 de Stemebro de 2024
{% endcomment %}

{% load static %}
{% load get_field %}

<link rel="stylesheet" href="{% static 'bootstrap-select-1.13.14/dist/css/bootstrap-select.min.css' %}">
<script src="{% static 'bootstrap-select-1.13.14/dist/js/bootstrap-select.min.js' %}"></script>

<style>
  table, th, td { border: 0px; }
  .btn-group.bootstrap-select select {
    width: 1px !important;
  }
  .url_reativo {font-size: 16px;}
  @media (max-width: 460px) {
    .url_reativo {font-size: 14px;}
  }
  {% comment %} Para seleção de projeto não vazar a tela {% endcomment %}
  .bootstrap-select > .dropdown-menu { 
    width: 100vw;
    max-width: fit-content;
  }
  label {display: inline;}
  @media (max-width: 600px) {
    #div_botao {
      flex-direction: column;
    }
    #mensagens {
      order: 2;
      margin-top: 0px;
    }
    #botoes {
      order: 1;
      margin-left: 0;
      margin-top: 0px;
    }
  }
</style>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <div class="modal-header">
    <h5 id="documentacao" class="modal-title">Atualiza Aula</h5>    
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div id="modal-body" class="modal-body" style="padding-bottom: 2px;">

    <label for="questao_problema_desafio">Questão / Problema / Desafio:</label>
    <textarea id="questao_problema_desafio" name="questao_problema_desafio" class="form-control" rows="4" maxlength="2000" 
      placeholder="Descreva a questão, problema ou desafio da aula...">{{ evento.questao_problema_desafio }}</textarea>
    <br>  

    <label for="atividade">Fundamentos / Conteúdo:</label>
    <textarea id="atividade" name="atividade" class="form-control" rows="4" maxlength="2000" 
      placeholder="Descreva os fundamentos / conteúdos da aula...">{{ evento.atividade }}</textarea>
    <br>

    <label for="evidencias_de_aprendizado">Evidências de Aprendizado:</label>
    <textarea id="evidencias_de_aprendizado" name="evidencias_de_aprendizado" class="form-control" rows="4" maxlength="2000" 
      placeholder="Descreva as evidências de aprendizado da aula...">{{ evento.evidencias_de_aprendizado }}</textarea>
    <br>  

    <label for="descricao">Programação / Atividades:</label> 
    <textarea id="descricao" name="descricao" class="form-control" rows="4" maxlength="2000" 
      placeholder="Descreva a programação / atividades da aula...">{{ evento.descricao }}</textarea>
    <br>

  </div>

  <div id="div_botao" class="modal-footer" style="display: flex; justify-content: space-between; gap: 20px;">
    <div id="botoes" style="margin-left: auto;">
      <button id="fecha_modal" type="button" class="btn btn-secondary mb-1" data-dismiss="modal">Fechar</button>
      <button id="submit" class="btn btn-primary mb-1" type="submit" name="atualizar">Enviar</button>
    </div>
  </div>

</form>


<script>

  $("form").submit(function(e){
    e.preventDefault();
    
    $.ajaxSetup({
      headers: { "X-CSRFToken": "{{csrf_token}}" }
    });

    var form = $("form").closest("form");
    var formData = new FormData(form[0]);
   
    $.ajax({
      type: "POST",
      url: "{{ url }}",
      data: formData,
      processData: false,
      contentType: false,
      success: function(data){
        if (data.atualizado) {
          // Refresh da página principal
          location.reload();
        }
        $("#popup").modal("hide");
      },
      {% include "ajax_error_function.js" %}
    });

    return false;

  });
        
</script>