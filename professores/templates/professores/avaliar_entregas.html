{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 14 de Janeiro de 2024
{% endcomment %}

{% block head %}
  {% load static %}
  {% load date_extras %}
  {% comment %} Para chamar os Tooltips {% endcomment %}
  <script>{% include "tooltip.js" %}</script>
  
  {% comment %} Para recarregar a página em caso de um botão back ou similar {% endcomment %}
  {% include "reload.html" %}

  <link rel="stylesheet" href="{% static 'css/div_arrend.css' %}">
  <link rel="stylesheet" href="{% static 'css/outros.css' %}">

{% endblock %}

{% block content %}

  <span class="titulo">Avaliar Entregas</span>

  {% comment %} Seletor da edição da pesquisa {% endcomment %}
  {% include "edicoes.html" %}
  <br>

  <div class="atualizar">

      {% for projeto, entregas in avaliacoes %}
        {% if projeto.tem_relatos %}
          <div class="div_arredondado">
          
            <div class="tresp"><strong>Projeto:</strong> <a href="{% url 'projeto_completo' projeto.id %}">{{projeto.get_titulo}}</a>
            {% include "tipo_projeto.html" with com_tipo=False %}</div>
            <strong>Organização:</strong>
            {% if projeto.organizacao %}
              <a href="{% url 'organizacao_completo' projeto.organizacao.id %}">{{ projeto.organizacao.nome }}</a>
            {% else %}
              ORGANIZAÇAO NÃO DEFINIDA
            {% endif %}
            <br>
            {% if edicao == "todas" %}
              <strong>Semestre:</strong> {{projeto.ano}}.{{projeto.semestre}}<br>
            {% endif %}
            <strong>Orientador:</strong>
            {% if projeto.orientador %}
              <a href="{% url 'professor_detail' projeto.orientador.id %}">{{projeto.orientador}}</a>
            {% else %}
              ORIENTADOR NÃO DEFINIDO
            {% endif %}
          
            <div style="margin:8px 0px 8px 0px; "><strong>Entregas:</strong></div>

            {% for item in entregas %}
            {% with dias_ate=item.2.endDate|dif_dias_hoje dias=14 %} {% comment %} Eventos são mostrados duas semanas antes do prazo {% endcomment %}
              <div style="border: 1px solid black; margin-bottom: 13px; padding: 0.2em;{% if dias_ate > dias %}display:inline-block;{% endif %}">
                <span {% if dias_ate > dias %}style="color:lightgrey;"{% endif %}>
                <b>{{item.0.exame.titulo}}</b> [prazo {{item.2.endDate}}]:</span>
                  {% comment %} {% if dias_ate > dias %}lightgrey{% endif %}" {% endcomment %}
                  {% comment %} <a id="adiciona" class="open-documento data-toggle="tooltip" data-html="true" animation="true"   item.1.last {% endcomment %}
                  {% comment %} onClick="check_prazo('{{item.2.endDate|date:"Y-m-d"}}T23:59:59');" {% endcomment %}
                <br>
                <ul style="padding-left: 22px; width: fit-content;">
                {% for documento in item.1 %}
                  <li style="list-style-type:'&#128463; ';">
                    {% if forloop.first%}<b>{% endif %}
                    {% if documento.documento or documento.link %}
                      <a 
                          {% if documento.usuario %} data-toggle="tooltip" data-html="true" animation="true" title="Entregue por {{documento.usuario.get_full_name}}"{% endif %}
                          class="{% if dias_ate > dias %}lightgrey{% endif %}"
                          {% if documento.usuario and not item.0.exame.grupo %}
                            href="{% url 'entrega_avaliar' item.0.id projeto.id documento.usuario.id %}"
                          {% else %}
                            href="{% url 'entrega_avaliar' item.0.id projeto.id %}"
                          {% endif %}
                          target="_blank" rel="noopener noreferrer">Entregue {{documento.data}}</a>
                    {% endif %}
                    {% if not item.0.exame.grupo %}
                      {% if documento.usuario %}
                        ({{documento.usuario.get_full_name}})
                      {% else %}
                        (ERRO AO IDENTIFICAR ESTUDANTE)
                      {% endif %}
                    {% endif %}
                    {% if documento.data|diff_days:item.2.endDate > 0 %}<span style="color: red;">[ENTREGUE APÓS PRAZO]</span>{% endif %}
                    {% if forloop.first%}</b>{% endif %}  
                  </li>
                {% empty %}
                  Não entregue
                {% endfor %} 
                </ul>
              </div>
            {% endwith %}
          {% endfor %} 

          </div>
        {% endif %}
      {% empty %}
       Sem alocações de projetos esse semestre.
      {% endfor %}

  </div> 

  <script>
    function carrega_pagina() {};
    function carrega_site() {
      var filterEdicao = localStorage.getItem("filterEdicao");
      if (filterEdicao !== null && $("#filterEdicao option[value='"+filterEdicao+"']").length > 0 ) {
        $('#filterEdicao').val(filterEdicao).trigger('change');
      }
      carrega_pagina();
    };
    window.onload = carrega_site
  </script>

  {% include "edicoes_ajax.html" %}

{% endblock %}