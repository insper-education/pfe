{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 3 de Outubro de 2019
{% endcomment %}

{% block head %}
{% endblock %}

{% block content %}

  <span class="titulo">Dinâmicas</span>

  {% comment %} Seletor da edição da pesquisa {% endcomment %}
  {% include "edicoes.html" %}

  <script>
    $('#filterEdicao').append($('<option>', {
        value: "proximas",
        text: 'proximas',
        selected: 'selected'
    }));
  </script>

  <div class="atualizar">

    {% if encontros %}
      <table>
        {% for e in encontros %} 
          <tr>
            <td>
              <a href="{% url 'dinamicas_editar' e.id %}">
                <big><b>{{e.startDate}} - {{e.endDate|date:'H:i'}}</b></big><br>
              </a>
              {% if e.projeto %}
                <b>Projeto:</b> <a href="{% url 'projeto_completo' e.projeto.id %}">
                  {{e.projeto.get_titulo}}
                </a><br>
                <b>Organização:</b> <a href="{% url 'organizacao_completo' e.projeto.organizacao.id %}">{{ e.projeto.organizacao.nome }}</a><br>
                {% if e.facilitador %}
                  <b>Facilitador:</b> <a href="{% url 'user_detail' e.facilitador.id %}">{{ e.facilitador.get_full_name }}</a>
                  <a href="mailto:{{e.facilitador.email}}">&lt;{{e.facilitador.email}}&gt;</a>&nbsp;
                  <br>
                {% endif %}
                <b>Grupo:</b>
                <ol>
                  {% for alocacao in e.projeto.alocacao_set.all %} 
                    <li><a href="{% url 'estudante_detail' alocacao.aluno.id %}">{{alocacao.aluno.user.get_full_name}} [{{ alocacao.aluno.get_curso_display }}]  <a href="mailto:{{alocacao.aluno.user.email}}">&lt;{{alocacao.aluno.user.email}}&gt;</a>&nbsp;
                    </a></li>
                  {% endfor %}
                </ol>
              {% else %}
                Horário Livre<br><br>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </table>
      <p>&nbsp;</p>
    {% else %}
      <p>Não existem encontros.</p>
    {% endif %}
    <p>&nbsp;</p>

    <script>
      function carrega_pagina(){
        {% include "edicoes_ajax.js" %}
      };
      function recarregar_pagina(){
        carrega_pagina();
      }
    </script>

  </div>

  <script>
    $(".filter").change(carrega_pagina);    
    $(document).ready(carrega_pagina);
  </script>  

{% endblock %}