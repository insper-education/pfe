{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 3 de Outubro de 2019
{% endcomment %}

{% block head %}

  {% comment %} Para recarregar a página em caso de um botão back ou similar {% endcomment %}
  {% include "reload.html" %}
  
  <style>
    .arrow {
      border: solid black;
      border-width: 0px 2px 2px 0px;
      display: inline-block;
      padding: 2px;
      vertical-align: middle;
    }

    .right {
      transform: rotate(-45deg);
      -webkit-transform: rotate(-45deg);
    }

    #toggle {
      display:inline-block; 
    }

  </style>
  
{% endblock %}

{% block content %}

  {% include "impressora.html" %}

  <span class="titulo">Mentorias</span>

  {% comment %} Seletor da edição da pesquisa {% endcomment %}
  {% include "edicoes.html" %}

  <script>
    $('#filterEdicao').append($('<option>', {
        value: "proximas",
        text: 'proximas',
        selected: 'selected'
    }));
  </script>

  <script>
    $(document).on('click','#informacoes_tag',function(){
      $( "#toggle" ).toggle( "slide" );
    });
  </script>

  <span id="informacoes" style="border: 1px solid gray; border-radius: 2px; padding: 1px; margin-left: 20px;">
    <span id="informacoes_tag">&nbsp;Informações <i class="arrow right"></i>&nbsp;</span>
    <div id="toggle" style="display: none; height: 1em;">
      <label><input id="orientador" onchange="($(this).prop('checked') ? $('.orientador').show() : $('.orientador').hide())" type="checkbox" checked /> orientador</label>&nbsp;&nbsp;&nbsp;
      <label><input id="local" onchange="($(this).prop('checked') ? $('.local').show() : $('.local').hide())" type="checkbox" checked /> local</label>&nbsp;&nbsp;&nbsp;
      <label><input id="grupo" onchange="($(this).prop('checked') ? $('.grupo').show() : $('.grupo').hide())" type="checkbox" checked /> grupo</label>&nbsp;&nbsp;&nbsp;
      <label><input id="curso" onchange="($(this).prop('checked') ? $('.curso').show() : $('.curso').hide())" type="checkbox" checked /> curso</label>&nbsp;&nbsp;&nbsp;
      <label><input id="facilitador" onchange="($(this).prop('checked') ? $('.facilitador').show() : $('.facilitador').hide())" type="checkbox" checked /> facilitador</label>&nbsp;&nbsp;&nbsp;
      <label><input id="sem_agendamento" onchange="($(this).prop('checked') ? $('.sem_agendamento').show() : $('.sem_agendamento').hide())" type="checkbox" checked /> sem agendamento</label>&nbsp;&nbsp;&nbsp;
    </div>
  </span>{% comment %} Mais elementos no carrega_pagina() {% endcomment %}

  <div class="atualizar">

    {% if encontros %}
      <table>
        {% for e in encontros %} 
          <tr>
            <td>
              <a class="imprimir" href="{% url 'dinamicas_editar' e.id %}">
                <big><b>{{e.startDate}} - {{e.endDate|date:'H:i'}}</b></big><br>
              </a>
              {% if e.projeto %}
                <b>Projeto:</b> <a class="imprimir" href="{% url 'projeto_completo' e.projeto.id %}">
                  {{e.projeto.get_titulo}}
                </a><br>
                <b>Organização:</b> <a class="imprimir" href="{% url 'organizacao_completo' e.projeto.organizacao.id %}">{{ e.projeto.organizacao.nome }}</a><br>
                <span class="orientador">
                  {% if e.projeto.orientador %}
                    {% if e.projeto.proposta.intercambio %}
                      <b>Professor{% if e.projeto.orientador.user.genero == 'F' %}a{% endif %} Responsável:</b>
                    {% else %}
                      <b>Orientador{% if e.projeto.orientador.user.genero == 'F' %}a{% endif %}:</b>
                    {% endif %}
                    <a class="imprimir" href="{% url 'professor_detail' e.projeto.orientador.id %}">
                      {{e.projeto.orientador.user.get_full_name}} 
                    </a>
                    <a class="email" href="mailto:{{e.projeto.orientador.user.email}}">&lt;{{e.projeto.orientador.user.email}}&gt;</a>
                  {% endif %}
                </span>
                
                {% if e.facilitador %}
                  <div class="facilitador" style="margin-top: 8px;">
                    <b>Facilitador:</b> <a class="imprimir" href="{% url 'user_detail' e.facilitador.id %}">{{ e.facilitador.get_full_name }}</a>
                    <a class="email" href="mailto:{{e.facilitador.email}}">&lt;{{e.facilitador.email}}&gt;</a>&nbsp;
                    <br>
                  </div>
                {% endif %}
                {% if e.location %}
                  <div class="local" style="margin-top: 8px;">
                    <b>Local:</b> 
                    {% if e.url_location %}
                      <a href="{{e.location}}">
                    {% endif %}
                    {{e.location}}
                    {% if e.url_location %}
                      </a>
                    {% endif %}
                    <br>
                  </div>
                {% endif %}
                <div class="grupo" style="margin-top: 8px;">
                  <b>Grupo:</b>
                  <ol>
                    {% for alocacao in e.projeto.alocacao_set.all %} 
                      <li><a class="imprimir" href="{% url 'estudante_detail' alocacao.aluno.id %}">{{alocacao.aluno.user.get_full_name}}
                      <span class="curso">[{{ alocacao.aluno.curso2 }}]</span>
                      <a class="email" href="mailto:{{alocacao.aluno.user.email}}">&lt;{{alocacao.aluno.user.email}}&gt;</a>&nbsp;
                      </a></li>
                    {% endfor %}
                  </ol>
                </div>
              {% else %}
                Horário Livre<br><br>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </table>
      <p>&nbsp;</p>
    {% else %}
      <p>Não existem encontros.</p>
    {% endif %}
    <p>&nbsp;</p>

    <div class="sem_agendamento">
      {% if sem_dinamicas %}
        <br>
        <h5>Projetos ativos sem mentorias agendadas:</h5>
        <ul>
        {% for projeto in sem_dinamicas %}
          <li>

            <a class="imprimir" href="{% url 'projeto_completo' projeto.id %}">{{projeto.get_titulo}}</a>
            {% include "tipo_projeto.html" %}<br>
            
            {% if projeto.organizacao %}
              [<a class="imprimir" href="{% url 'organizacao_completo' projeto.organizacao.id %}"
                >{{ projeto.organizacao.nome }}</a
              >]
            {% endif %}

          </li>
        {% endfor %}
        </ul>
      {% endif %}
    </div>

    <script>

      function carrega_pagina() {
        ($("#orientador").prop('checked') ? $('.orientador').show() : $('.orientador').hide());
        ($("#local").prop('checked') ? $('.local').show() : $('.local').hide());
        ($("#grupo").prop('checked') ? $('.grupo').show() : $('.grupo').hide());
        ($("#curso").prop('checked') ? $('.curso').show() : $('.curso').hide());
        ($("#facilitador").prop('checked') ? $('.facilitador').show() : $('.facilitador').hide());
        ($("#sem_agendamento").prop('checked') ? $('.sem_agendamento').show() : $('.sem_agendamento').hide());
      };

      function carrega_site() {
        var filterEdicao = localStorage.getItem("filterEdicao");
        if (filterEdicao !== null && $("#filterEdicao option[value='"+filterEdicao+"']").length > 0 ) {
          $('#filterEdicao').val(filterEdicao).trigger('change');
        }
        carrega_pagina();
      };

      window.onload = carrega_site
    </script>

  </div>

  {% include "edicoes_ajax.html" %}

{% endblock %}