{% extends "base.html" %}
{% comment %}
  Desenvolvido para o Projeto Final de Engenharia
  Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
  Data: 20 de Fevereiro de 2022
{% endcomment %}

{% load static %}
{% load i18n %}
{% load linguas %}
{% load relatos %}

{% block head %}
  {% include "reload.html" %}
  <link rel="stylesheet" href="{% static 'css/div_arrend.css' %}">
{% endblock %}

{% block content %}
  
  {% include "edicoes.html" %}
  
  <div id="atualizar">

    {% if not edicoes %}
      {% for projeto in projetos %}
        {% if projeto %}
          <div class="div_arredondado">
          
            {% include "cabecalho_projeto.html" with com_tit_original=True %}
            <hr>
            <div class="mt-2" style="font-weight: 600; font-size: 1.05rem; color: #1f2a44;">
              <strong>{% lng "Alocações Semanais dos Estudantes" "Weekly Allocations of Students" %}</strong>
            </div>

            {% include "mostra_horarios.html" with com_orientacoes=n_todos %}

          </div>
        {% endif %}
      {% empty %}
        {% lng "Sem alocações de projetos esse semestre." "No project allocations this semester." %}
      {% endfor %}
    {% endif %}

    
    {% if edicao and administracao and stats_projetos %}
      <div class="mt-3" style="border: 1px solid #000000; background-color: #f3f4f6; padding: 12px; border-radius: 4px;">
      
        <div class="mb-2">
          <b>{% lng "Estatísticas de Alocação" "Allocation Statistics" %}</b>
        </div>

        <!-- Alunos que não preencheram -->
        <strong>{% lng "Estudantes que ainda não preencheram sua alocação:" "Students who have not yet filled in their allocation:" %}</strong>
        <div class="table-responsive mb-4" style="font-size: 0.85rem;">
          <table class="tabela-padrao table-sm table-hover">
            <thead>
              <tr>
                <th>{% lng "Aluno" "Student" %}</th>
                <th>{% lng "Email" "Email" %}</th>
                <th>{% lng "Externo" "External" %}</th>
                <th>{% lng "Projeto" "Project" %}</th>
                <th>{% lng "Orientador" "Advisor" %}</th>
              </tr>
            </thead>
            <tbody>
              {% for aluno_stat in stats_alunos %}
                {% if aluno_stat.status == "não_preenchido" %}
                  <tr>
                    <td>{{ aluno_stat.aluno.user.get_full_name }}</td>
                    <td><a href="mailto:{{ aluno_stat.email }}">{{ aluno_stat.email }}</a></td>
                    <td>{% if aluno_stat.externo %}<span class="badge badge-info">{{ aluno_stat.externo }}</span>{% endif %}</td>
                    <td>{{ aluno_stat.projeto.get_titulo_org }}</td>
                    <td>{{ aluno_stat.orientador.user.get_full_name }}</td>
                  </tr>
                {% endif %}
              {% endfor %}          
            </tbody>
          </table>
        </div>

        
        <!-- Histograma de Horas dos Estudantes -->
        <div class="mt-4">
          <b>{% lng "Distribuição de Horas de Dedicação Individual" "Distribution of Individual Dedication Hours" %}</b>
          <div class="table-responsive">
            <table class="tabela-padrao table-sm table-hover" style="max-width: 500px;">
              <thead>
                <tr>
                  <th>{% lng "Faixa de Horas" "Hour Range" %}</th>
                  <th class="text-center">{% lng "Quantidade" "Count" %}</th>
                </tr>
              </thead>
              <tbody>
                {% for faixa, item in histogram_alunos.items %}
                  <tr style="cursor: help;" title="{% for nome in item.alunos %}{{ nome }}&#10;{% endfor %}">
                    <td>{{ faixa }}</td>
                    <td class="text-center"><strong>{{ item.count }}</strong></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Histograma de Horas Juntos dos Projetos -->
        <div class="mt-4">
          <b>{% lng "Distribuição de Horas de Trabalho em Grupo" "Distribution of Group Work Hours" %}</b>
          <div class="table-responsive">
            <table class="tabela-padrao table-sm table-hover" style="max-width: 500px;">
              <thead>
                <tr>
                  <th>{% lng "Faixa de Horas Juntos" "Group Hours Range" %}</th>
                  <th class="text-center">{% lng "Quantidade de Projetos" "Number of Projects" %}</th>
                </tr>
              </thead>
              <tbody>
                {% for faixa, item in histogram_projetos.items %}
                  <tr style="cursor: help;" title="{% for nome in item.projetos %}{{ nome }}&#10;{% endfor %}">
                    <td>{{ faixa }}</td>
                    <td class="text-center"><strong>{{ item.count }}</strong></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% endif %}
    
    </div>

  </div> 

  <script>
    
    {% if administracao %}
      function carrega_pagina() {}
    {% endif %}

    function carrega_site() {
      {% include "edicao_puxar_local_ou_versao.js" %}
    };
    window.onload = carrega_site
  </script>

  {% include "edicoes_ajax.html" %}

{% endblock %}