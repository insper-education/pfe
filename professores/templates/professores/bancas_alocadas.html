{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 3 de Abril de 2023
{% endcomment %}

{% block head %}
  {% load static %}
  {% load certificado_banca %}
  <script>{% include "tooltip.js" %}</script>

  {% comment %} Para recarregar a página em caso de um botão back ou similar {% endcomment %}
  {% include "reload.html" %}
  
  <style>
    .opt_short {
      display: none;
    }
    .opt_full {
      display: inline;
    }

    @media screen and (max-width: 800px) {
      .opt_short {
        display: inline;
      }
      .opt_full {
        display: none;
      }
    }

    .arredondado {
      table-layout: fixed;
      max-width: 100%;
      border-collapse:separate;
      border-spacing: 4px 6px;
      margin-left: 6px;
      margin-right: 12px;
      margin-bottom: 6px;
      border: 0px;
    }

    .arredondado tr {
      background: #F0F0F0;
      line-height:1;
      height: 1px;
    }

    .arredondado td {
      vertical-align: middle;
      border: 1px solid grey;
      border-radius: 6px;
    }

  </style>

{% endblock %}

{% block content %}
  
    <span class="titulo">Participação em Bancas</span>

    {% for banca in bancas %}
      {% ifchanged banca.periodo %}
        {% if not forloop.first %}</tbody></table>{% endif %}
        <div style="margin-top: 1em; font-weight: bold; font-size: 1.2rem;">{{ banca.periodo }}</div>
        <table class="table table-borderless table-sm arredondado"><tbody>
      {% endifchanged %}

      <tr><td>
        <div>
          <small style="margin-right: 1px;">#{{ forloop.revcounter }}.</small>
          <a href="{% url 'banca_ver' banca.id %}">
            <b>{{ banca.get_tipo }}</b> &#x2726;
            {% if banca.startDate %}
              <b><span class="opt_full">{{ banca.startDate|date:"DATETIME_FORMAT" }}</span>
                 <span class="opt_short">{{ banca.startDate|date:"d/m/y H:i" }}</span></b>
            {% endif %} &#x2726;
            {% if user.professor and banca.projeto.orientador == user.professor %}
              <i>(ORIENTADOR{% if user.genero == 'F' %}A{% endif %})</i>
            {% endif %}
            {% with coorientadores=banca.projeto.coorientador_set.all %}
              {% for coorientador in coorientadores %}
                {% if coorientador.usuario == user %}
                  <i>(COORIENTADOR{% if user.genero == 'F' %}A{% endif %})</i>
                {% endif %}
              {% endfor %}
            {% endwith %}
            {% if not user.professor or user.professor and banca.projeto.orientador != user.professor %}
              <i><span class="opt_short">Ori.</span><span class="opt_full">Orientador{% if user.genero == 'F' %}a{% endif %}</span>: {{banca.projeto.orientador}}</i>
            {% endif %}
          </a>
        </div>
          
          {% if banca.projeto %}
            <div style="max-width: 100%; display: inline-block; overflow-x: clip; text-overflow: ellipsis; text-wrap: nowrap;">
            {% if banca.projeto.organizacao %}
              <a href="{% url 'organizacao_completo' banca.projeto.organizacao.id %}">
                {{ banca.projeto.organizacao.nome }},</a>
            {% endif %}
          
            <a href="{% url 'projeto_completo' banca.projeto.id %}">
              {{banca.projeto.get_titulo}},</a>
              </div>
          {% endif %}

          {% with certificado=banca|certificado_banca:user %}
            {% if certificado %}
              <div>
              <a href="{{certificado}}" target="_blank" rel="noopener noreferrer"><b>[CERTIFICADO]</b></a><br>
              </div>
            {% endif %}
          {% endwith %}
            </td></tr>
      {% empty %}
        Não existem Bancas cadastradas.
      {% endfor %}
      </tbody></table>

{% endblock %}