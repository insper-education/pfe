{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 31 de Janeiro de 2022
{% endcomment %}

{% block head %}

  {% load banca_tipo %}

  <script>{% include "tooltip.js" %}</script>

  <style>
    textarea {max-width:100%;}
    label {margin: 3px;}
    table, td {vertical-align: top;}

    @media only screen and (max-width: 1100px) {
      table, th, td {font-size: 14px;}
    }

    @media only screen and (max-width: 1000px) {
      table, th, td {font-size: 12px;}
      .nivel {display:none;}
    } 

    @media only screen and (max-width: 800px) {
      table, th, td {font-size: 14px;}
      tbody {display: flex;}
      tr {
        display: flex;
        flex-wrap: wrap;
      }
      th, td {        
        flex-basis: 100%;
        min-height: calc(130px - 5vw);;
      }

    }

    @media only screen and (max-width: 500px) {
      table, th, td {font-size: 12px;}
    }

    label.reduzido {
      display: block;
      line-height: 1.2;
      font-size: 14px;
    }

    datalist {
      display: flex;
      justify-content: space-between;
    }
    
  </style>

{% endblock %}

{% block content %}

  <form method="post" id="avaliacaoform" enctype="multipart/form-data">
    {% csrf_token %}

    <b>Projeto:</b> <a href="{% url 'projeto_completo' projeto.id %}">{{projeto.get_titulo}}</a><br>
    {% if projeto.orientador %}
      {% if projeto.proposta.intercambio %}
        <b>Professor{% if projeto.orientador.user.genero == 'F' %}a{% endif %} Responsável:</b>
      {% else %}
        <b>Orientador{% if projeto.orientador.user.genero == 'F' %}a{% endif %}:</b>
      {% endif %}
      <a href="{% url 'professor_detail' projeto.orientador.id %}">
      {{projeto.orientador}}
      </a>
    {% else %}
      Orientador: Não definido
    {% endif %}<br>
    <b>Data limite do relato:</b> {{evento.endDate}}<br>
    
    <br>
    {% for alocacao, relato in alocacoes_relatos %}

      <div id="{{alocacao.id}}" class="panel panel-default border border-secondary rounded" style="display: inline-block; padding: 8px 12px 8px 12px; max-width: 100%;">

        <b>Estudante: </b><a href="{% url 'estudante_detail' alocacao.aluno.id %}">{{alocacao.aluno}}</a><br>
        <b>Preenchimento: </b>
        {% if relato %}
          {{relato.momento|date:"DATE_FORMAT"}}
        {% else %}
            Não entregue
        {% endif %}  
        <br>
        <textarea id="relato" name="relato" rows="10" cols="160" maxlength="4096" disabled>{{relato.texto}}</textarea><br>

        <label>Desempenho:</label>
        <div style="width: fit-content; display: inline-block; margin-left: 8px;" {% if not relato %}data-toggle="tooltip" data-html="true" animation="true" title="Estudante não entregou relato"{% endif %}>
          <div class="custom-control custom-radio custom-control-inline">
            <input type="radio" id="customRadioInline0{{relato.id}}" name="op.{{relato.id}}" class="custom-control-input"
                    value="1" {% if relato.avaliacao > 0 %}checked="checked"{% endif %} {% if not relato or not editor %}disabled {% endif %}>
            <label class="custom-control-label" for="customRadioInline0{{relato.id}}">Adequado</label>
          </div>
          <div class="custom-control custom-radio custom-control-inline">
            <input type="radio" id="customRadioInline1{{relato.id}}" name="op.{{relato.id}}" class="custom-control-input"
                    value="0" {% if relato.avaliacao == 0 %}checked="checked"{% endif %} {% if not relato or not editor %}disabled {% endif %}>
            <label class="custom-control-label" for="customRadioInline1{{relato.id}}">Inadequado</label>
          </div>
        </div>
      </div>
      <br><br>

    {% endfor %}

    <label for="observacoes">Informe suas observações para a coordenação do PFE.</label><br>
    <textarea id="observacoes" name="observacoes" rows="18" cols="164" maxlength="4096" {% if not editor %}disabled{% endif %}
              placeholder="Caso identifique alguma dificuldade com qualquer estudante ou o grupo, descreva aqui que a coordenação do PFE irá lhe auxiliar.">{% if observacoes %}{{observacoes}}{% endif %}</textarea>

    <p>&nbsp;</p>

    {% if editor %}
      <button class="btn btn-primary mb-1"
      {% if evento.em_prazo %}
        onClick="return confirm('Tem certeza que deseja enviar a avaliação? Os estudantes ainda estão no prazo para entregar o relato.');" 
      {% endif %}
      type="submit">Concluir Avaliação</button>
    {% endif %}

  </form>

{% endblock %}