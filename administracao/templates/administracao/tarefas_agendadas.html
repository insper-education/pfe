{% extends "base.html" %}
{% comment %}
  Desenvolvido para o Projeto Final de Engenharia
  Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
  Data: 4 de Agosto de 2019
{% endcomment %}

{% load linguas %}

{% block content %}

  <div>{% lng "Agora" "Now" %}: {{ agora }}</div><br>

  <!-- TAREFAS EM EXECUÇÃO (ACTIVE) -->
  {% if active_tasks %}
    <h3>{% lng "Tarefas em Execução" "Running Tasks" %}</h3>
    <table border="1" style="width: 100%; margin-bottom: 20px;">
      <thead>
        <tr>
          <th>Worker</th>
          <th>Task ID</th>
          <th>Task Name</th>
          <th>Args</th>
          <th>Time Start</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for worker, tasks in active_tasks.items %}
          {% for task in tasks %}
            <tr style="background-color: #fff3cd;">
              <td>{{ worker }}</td>
              <td>{{ task.id }}</td>
              <td>{{ task.name }}</td>
              <td>{{ task.args }}</td>
              <td>{{ task.time_start }}</td>
              <td>
                <form method="post" action="{% url 'cancela_tarefa' task.id %}" style="display: inline;">
                  {% csrf_token %}
                  <button type="submit" style="background-color: #ff6b6b; color: white; padding: 5px 10px; border: none; cursor: pointer;">{% lng "Cancelar" "Cancel" %}</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  <!-- TAREFAS RESERVADAS (RESERVED) -->
  {% if reserved_tasks %}
    <h3>{% lng "Tarefas Reservadas" "Reserved Tasks" %}</h3>
    <table border="1" style="width: 100%; margin-bottom: 20px;">
      <thead>
        <tr>
          <th>Worker</th>
          <th>Task ID</th>
          <th>Task Name</th>
          <th>Args</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for worker, tasks in reserved_tasks.items %}
          {% for task in tasks %}
            <tr style="background-color: #e7f3ff;">
              <td>{{ worker }}</td>
              <td>{{ task.id }}</td>
              <td>{{ task.name }}</td>
              <td>{{ task.args }}</td>
              <td>
                <form method="post" action="{% url 'cancela_tarefa' task.id %}" style="display: inline;">
                  {% csrf_token %}
                  <button type="submit" style="background-color: #ff6b6b; color: white; padding: 5px 10px; border: none; cursor: pointer;">{% lng "Cancelar" "Cancel" %}</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  <!-- TAREFAS AGENDADAS (SCHEDULED) -->
  {% if scheduled_tasks %}
    <h3>{% lng "Tarefas Agendadas" "Scheduled Tasks" %}</h3>
    <table border="1" style="width: 100%;">
      <thead>
        <tr>
          <th>ETA</th>
          <th>Task ID</th>
          <th>Task Name</th>
          <th>Args</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for worker, tasks in scheduled_tasks.items %}
          {% for task in tasks %}
            <tr>
              <td>{{ task.eta }}</td>
              <td>{{ task.request.id }}</td>
              <td>{{ task.request.name }}</td>
              <td>{{ task.request.args }}</td>
              <td>
                {% if task and task.request and task.request.id %}
                  <form method="post" action="{% url 'cancela_tarefa' task.request.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" style="background-color: #ff6b6b; color: white; padding: 5px 10px; border: none; cursor: pointer;">{% lng "Cancelar" "Cancel" %}</button>
                  </form>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  {% if not active_tasks and not reserved_tasks and not scheduled_tasks %}
    <p style="color: #666; font-style: italic;">{% lng "Nenhuma tarefa em execução, reservada ou agendada." "No running, reserved or scheduled tasks." %}</p>
  {% endif %}

  <br>
  <div>
    {% lng "A informação do ETA é o horário estimado para a execução da tarefa, porém a informação não parece estar alinhada com os relógios disponíveis." "The ETA information is the estimated time for the task to be executed, however the information does not seem to be aligned with the available clocks." %}
  </div>
  <div>
    {% lng " Quando uma tarefa é cancelada, ela é removida da fila de tarefas agendadas e não será executada. Porém ela vai continuar sendo visível nessa lista até que o worker a remova. " " When a task is canceled, it is removed from the scheduled tasks queue and will not be executed. However, it will continue to be visible in this list until the worker removes it. " %}
  </div>
{% endblock %}
