{% extends "base.html" %}
{% comment %}
  Desenvolvido para o Projeto Final de Engenharia
  Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
  Data: 23 de Fevereiro de 2025
{% endcomment %}

{% block head %}
  {% load static %}
  {% load bleach %}
  {% load l10n %}
  {% load alocacoes %}
  {% load relatos %}
  {% load addhttp %}
  {% load linguas %}
  {% load get_notas %}
  {% load get_descontos %}
  {% load exibe_notas %}
  {% load documentos %}

  <link rel="stylesheet" href="{% static 'css/caixa_rolante.css' %}">
  <link rel="stylesheet" href="{% static 'css/mostra_horarios.css' %}">
  <link rel="stylesheet" href="{% static 'css/tab_arrend.css' %}"> {% comment %} SETAS {% endcomment %}
  <link rel="stylesheet" href="{% static 'css/div_arrend.css' %}">
  <script src="{% static 'js/Chart.min.js' %}"></script>

  {% include "reload.html" %}  {% comment %} Atualiza as conexões quando se da um back {% endcomment %}

  <style>
    .wbtn {
      width: 11em;
      margin: 0.25em 0;
    }
    .medias-title {
      font-size: 1.05em;
      font-weight: 550;
      color: #333;
      display: inline-block;
    }
    
    .bloco-destaque-projeto {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1em;
      padding: 0.8em;
      border: 1.5px solid #0cf;
    }
    .bloco-destaque-projeto:hover {
      box-shadow: 0 4px 24px 0 rgba(120,160,200,0.13);
    }
    .bloco-destaque-projeto .logotipo {
      max-height: 80px;
      margin-left: 12px;
      padding: 2px;
    }

    .usuarios-stack { list-style: none; padding: 0; margin: 0; border-radius: 8px; background: #fff; box-shadow: 0 2px 12px rgba(0,0,0,.05); }
    .usuario-item { border-bottom: 1px solid #eee; }
    .usuario-item:last-child { border-bottom: 0; }

    .usuario-item > summary {
      cursor: pointer;
      display: grid;
      grid-template-columns: 8px 1fr auto;
      gap: 2px;
      align-items: center;
      padding: 2px 6px;
      list-style: none;
    }
    .usuario-item > summary::-webkit-details-marker { display: none; }

    .aluno-accent { width: 3px; height: 100%; border-radius: 2px; background: #9ac3ff; }
    .associado-accent { width: 3px; height: 100%; border-radius: 2px; background: #85e3a1; }
    .conexao-accent { width: 3px; height: 100%; border-radius: 2px; background: #f5d185; }
    .coorientador-accent { width: 3px; height: 100%; border-radius: 2px; background: #c985f5; }

    .usuario-item.is-externo .aluno-accent { background: #f59f85; } /* externo highlight */

    .usuario-item:hover { background: #f9fbff; }
    .aluno-extra { padding: 0 12px 10px 20px; }

    .mentoria-timeline { list-style: none; margin: 0; padding-left: 18px; position: relative; }
    .mentoria-timeline::before { content:""; position:absolute; left:8px; top:0; bottom:0; width:2px; background:#e6e9ef; }
    .mentoria-item { position: relative; margin-bottom: 12px; }
    .mentoria-item .dot { position:absolute; left:2px; top:12px; width:12px; height:12px; border-radius:50%; background:#6ea8fe; border:2px solid #fff; box-shadow:0 0 0 2px #e6e9ef; }

    .mentoria-card { background:#fff; border:1px solid #e9ecef; border-radius:8px; padding:8px 10px; box-shadow:0 2px 10px rgba(0,0,0,.03); }
    .mentoria-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:6px; margin-bottom:6px; }
    .mentoria-when { font-weight:500; }
    .mentoria-chips .badge { margin-left:4px; }
    .mentoria-body .section { margin-top:6px; }
    .mentoria-body .section > .title { font-weight:600; font-size:.95em; color:#394a6d; display:inline-flex; align-items:center; gap:6px; }
    .mentoria-body .section > .content { margin-top:2px; font-size:.95em; }



{% comment %} REMOVER REMOVER REMOVER REMOVER {% endcomment %}
.curso-chip {
  align-items: center;
  vertical-align: middle;
  white-space: nowrap;

  font-size: 0.8em;
  line-height: 1.0;
  padding-bottom: 2px;
  border-radius: 3px;

  color: #000000ff;
  /* fallback (no washout) */
  background-color: var(--chip-bg);
  background-color: color-mix(in oklch, var(--chip-bg) 15%, white 85%);
  
  filter: brightness(1.05);
  box-shadow: 0 0 0 0 rgba(0,0,0,0);
  transition: box-shadow .15s ease, filter .15s ease, background-color .15s ease, border-color .15s ease;
}
.curso-chip:hover,
.curso-chip:focus {
  box-shadow: 0 1px 8px rgba(16,58,126,.18);
}
{% comment %} REMOVER  {% endcomment %}

  </style>

{% endblock %}
{% block content %}

  {% if not projeto.organizacao %}
    <h1 class="text-danger">{% lng "Erro grave - Projeto sem organização" "Serious error - Project without organization" %}</h1>
  {% endif %}

  <div class="div_arredondado_100">

    <div class="bloco-destaque-projeto" style="display: flex;">
      <div style="flex: 1; min-width: 0;">

        <h4>
          {% lng "Título" "Title" %}:
          {{ projeto.get_titulo }}
          {% if projeto.titulo_final and projeto.titulo_final != projeto.proposta.titulo %}
            <span style="font-size: small; padding-left: 0.7em; display: block;">
              <b>{% lng "Título original da proposta" "Original title of the proposal" %}:</b> {{projeto.proposta.titulo}}
            </span>
          {% endif %}
        </h4>

        <b>{% lng "Semestre" "Semester" %}</b>:
        {{projeto.ano}}.{{projeto.semestre}}

        {% include "tipo_projeto.html" with com_tipo=True %}
        <br>

        <b>{% lng "Organização" "Organization" %}</b>:
        {% if projeto.organizacao %}
          {% if user.eh_prof_a %}
            <a href="{% url 'organizacao_completo' projeto.organizacao.id %}">{{ projeto.organizacao.nome }}</a>
          {% else %}
            {{ projeto.organizacao.nome }}
          {% endif %}
        {% else %}
          {% lng "ORGANIZAÇÃO NÃO DEFINIDA" "ORGANIZATION NOT DEFINED" %}
        {% endif %}
        
        {% for conexao in cooperacoes %}
          {% if conexao.parceiro and conexao.parceiro.organizacao %}
            <span class="ml-4">
              ( {% lng "colaboração" "collaboration" %}:
              <a href="{% url 'organizacao_completo' conexao.parceiro.organizacao.id %}">
                {{conexao.parceiro.organizacao}}
              </a> )
            </span>
          {% endif %}
        {% endfor %}
        <br>
      </div>
      
      {% if projeto.organizacao and projeto.organizacao.logotipo %}
        <img class="logotipo" src="{{ projeto.organizacao.logotipo.url }}" alt="{{ projeto.organizacao.sigla }}">
      {% endif %}

      {% for conexao in cooperacoes %}
        {% if conexao.parceiro and conexao.parceiro.organizacao and conexao.parceiro.organizacao.logotipo %}
          <a href="{% url 'organizacao_completo' conexao.parceiro.organizacao.id %}">
            <img class="logotipo" src="{{ conexao.parceiro.organizacao.logotipo.url }}" alt="{{ conexao.parceiro.organizacao.sigla }}">
          </a>
        {% endif %}
      {% endfor %}

    </div>

    {% if projeto.resumo %}
      <hr>
      <div class="resumo mt-3">
        <strong>{% lng "Resumo do Projeto (escrito por estudantes)" "Project Summary (written by students)" %}:</strong>
        {{ projeto.resumo|linebreaks }}
      </div>
    {% endif %}

    {% if projeto.abstract %}
      <div class="abstract mt-3">
        <strong>{% lng "Resumo em Inglês do Projeto (escrito por estudantes)" "Project Summary in English (written by students)" %}:</strong>
        {{ projeto.abstract|linebreaks }}
      </div>
    {% endif %}

    {% if projeto.palavras_chave %}
      <div class="palavras_chave mt-3">
        <strong>{% lng "Palavras-chave (escrito por estudantes)" "Keywords (written by students)" %}:</strong>
        {{ projeto.palavras_chave|linebreaks }}
      </div>
    {% endif %}

    <hr>

    {% comment %} <div class="endereco mt-3">
      <strong>{% lng "Endereço" "Address" %}:</strong><br>
      <a style="display: inline-block; padding-left: 0.7em;" href="http://maps.google.com/maps?q={{projeto.organizacao.endereco}}">{{ projeto.organizacao.endereco|linebreaks }}</a></p>
    </div>
    
    {% if projeto.organizacao.website or projeto.proposta.website %}
      <div class="website mt-3">
        <strong>website:</strong>
        {% if projeto.organizacao and projeto.organizacao.website %}
          <a href="{{projeto.organizacao.website|add_http}}">{{projeto.organizacao.website}}</a>
        {% elif projeto.proposta and projeto.proposta.website %}
          <a href="{{projeto.proposta.website|add_http}}">{{projeto.proposta.website}}</a>
        {% endif %}
      </div>
    {% endif %} {% endcomment %}

    {% if projeto.proposta.descricao %}
      <div class="descricao mt-3">
        <strong>{% lng "Descrição da Proposta do Projeto (escrito por parceiro)" "Description of the Project Proposal (written by partner)" %}:</strong>
        {{ projeto.proposta.descricao|linebreaks|bleach_urlize|safe }}
      </div>
    {% else %}
      <div><u>{% lng "Campo de descrição ausente." "Field description missing." %}</u></div>
      <!-- Campo deveria ser obrigatório -->
    {% endif %}

    {% if projeto.proposta.expectativas %}
      <div class="expectativas mt-3">
        <strong>{% lng "Expectativas de resultados/entregas (escrito por parceiro)" "Expectations of results/deliverables (written by partner)" %}</strong>
        {{ projeto.proposta.expectativas|linebreaks|bleach_urlize|safe }}
      </div>
    {% else %}
      <div><u>{% lng "Campo de expectativas ausente." "Field expectations missing." %}</u></div>
      <!-- Campo deveria ser obrigatório -->
    {% endif %}

    {% if projeto.proposta.recursos %}
      <div class="recusos mt-3">
        <strong>{% lng "Recursos a serem disponibilizados aos estudantes (escrito por parceiro)" "Resources to be made available to students (written by partner)" %}</strong>
        {{ projeto.proposta.recursos|linebreaks|bleach_urlize|safe }}
      </div>
    {% endif %}

    {% if projeto.proposta.observacoes %}
      <div class="observacoes mt-3">
        <strong>{% lng "Outras Observações (escrito por parceiro)" "Other Observations (written by partner)" %}</strong>
        {{ projeto.proposta.observacoes|linebreaks|bleach_urlize|safe }}
      </div>
    {% endif %}

    {% if projeto.organizacao.informacoes %}
      <div class="informacoes mt-3">
        <strong>{% lng "Informações sobre a organização" "Information about the organization" %}</strong>
        {{ projeto.organizacao.informacoes|linebreaks|bleach_urlize|safe }}
      </div>
    {% endif %}

    {% if projeto.proposta.departamento %}
      <div class="departamento mt-3">
        <strong>{% lng "Informações sobre o departamento na organização" "Information about the department in the organization" %}</strong> {{ projeto.proposta.departamento|linebreaks|bleach_urlize|safe }}
      </div>
    {% endif %}

    {% if projeto.proposta.anexo %}
      <br>
      <strong>{% lng "Anexo (fornecido por parceiro)" "Attachment (provided by partner)" %}:</strong>
      <a class="text-success" href="http://{{request.get_host}}{{projeto.proposta.anexo.url}}">{{projeto.proposta.anexo}}</a>
      <br>
    {% endif %}
    
    <div class="conexoes" style="margin-top: 8px;">
      <strong>{% lng "Conexões" "Connections" %}:</strong>
      {% if conexoes %}
        <span class="emails esconder">
          <a href="mailto:{% for conexao in conexoes %}{{conexao.parceiro.user.email}}{% if not forloop.last %};{% endif %}{% endfor %}?subject=Capstone%20Insper%20-%20Projeto:%20{{projeto}}&body=Caro{% if conexoes|length > 1 %}s{% endif %}%20{% for conexao in conexoes %}{% if not forloop.first %}{% if forloop.last %}%20e{% else %},{% endif %}%20{% endif %}{{conexao.parceiro.user.get_full_name}}{% endfor %},%0D%0A%0D%0Aatenciosamente,%20{{configuracao.coordenacao.coordenador_email}}%20(coordenação%20Capstone)" target="_blank">
            <i class="fas fa-mail-bulk"></i>
          </a>
        </span>
      {% endif %}
      {% if user.eh_prof_a %}
        <small class="esconder"><a style="vertical-align: 0px;" href="{% url 'seleciona_conexoes' %}?projeto={{projeto.id}}">&#x1F517;</a></small>
      {% endif %}<br>
      {% if conexoes %}
        <ul class="usuarios-stack mt-2">
        {% for conexao in conexoes %}
          {% if conexao.parceiro.user.is_active %}
            <details class="usuario-item " open>
              <summary>
              <span class="conexao-accent"></span>
              <div>
              {% if conexao.parceiro %}
                {% if user.eh_prof_a %}
                  <a href="{% url 'parceiro_detail' conexao.parceiro.id %}">{{ conexao.parceiro.user.get_full_name }}</a>
                {% else %}
                  {{ conexao.parceiro.user.get_full_name }}
                {% endif %}

                <a href="mailto:{{conexao.parceiro.user.email}}">
                  <span class="texto-longo">&lt;{{conexao.parceiro.user.email}}&gt;</span>
                  <span class="texto-curto"><i class="far fa-envelope"></i></span>
                </a>

              {% else %}
                {% lng "PARCEIRO NÃO CADASTRADO" "ORGANIZATION NOT REGISTERED" %}
              {% endif %}
              {% for papel in conexao.get_papeis %}
                <span class="badge badge-pill badge-light border ml-1 align-middle texto-longo unselectable"
                      style="--c: {{papel.cor}}; color: var(--c); border-color: var(--c); background-color: rgba(255,255,255,.75);">
                  {% lng papel.nome papel.nome_en %}
                </span>
                <span class="badge badge-pill badge-light border ml-1 align-middle texto-curto unselectable"
                      style="--c: {{papel.cor}}; color: var(--c); border-color: var(--c); background-color: rgba(255,255,255,.75);"
                      data-toggle="tooltip" data-html="true" animation="true" title="{{papel.nome}}">
                  {{papel.sigla}}
                </span>
                {% endfor %}
              {% if conexao.observacao %}&nbsp;&nbsp;obs: {{conexao.observacao}}{% endif %}
            </div>
            </summary>
          </details>
          {% else %}
            <details class="usuario-item " open>
            <summary>
              <span class="conexao-accent"></span>
              <div>
              {% if conexao.parceiro %}
                <a href="{% url 'parceiro_detail' conexao.parceiro.id %}" style="color: LightBlue;">
                  {{ conexao.parceiro.user.get_full_name }}
                </a>
                <a href="mailto:{{conexao.parceiro.user.email}}" style="color: LightBlue;">
                  <span class="texto-longo">&lt;{{conexao.parceiro.user.email}}&gt;</span>
                  <span class="texto-curto"><i class="far fa-envelope"></i></span>
                </a>
              {% else %}
                <span style="color: lightgrey;">{% lng "PARCEIRO NÃO CADASTRADO" "ORGANIZATION NOT REGISTERED" %}</span>
              {% endif %}
              <span style="color: lightgrey; border: 0px; ">
                {% for papel in conexao.get_papeis %}
                  <span class="badge badge-pill badge-light border text-muted ml-1 align-middle texto-longo unselectable">{% lng papel.nome papel.nome_en %}</span>
                  <span class="badge badge-pill badge-light border text-muted ml-1 align-middle texto-curto unselectable"
                        data-toggle="tooltip" data-html="true" animation="true" title="{{papel.nome}}">
                    {{papel.sigla}}
                  </span>
                {% endfor %}
                {% if conexao.observacao %}&nbsp;&nbsp;obs: {{conexao.observacao}}{% endif %}
              </span>
            </div>
            </summary>
          </details>
          {% endif %}        
        {% endfor %}
        </ul>
      {% else %}
        {% lng "Nenhuma conexão específica para esse projeto declarada." "No specific connection declared for this project." %}
      {% endif %}
      
    </div>

    <hr>
    {% if projeto.orientador %}
      {% if projeto.proposta.intercambio %}
        <h5>{% lng_g projeto.orientador.user.genero "Professor Responsável" "Professora Responsável" "Responsible Professor" %}:</h5>
      {% else %}
        <h5>{% lng_g projeto.orientador.user.genero "Orientador" "Orientadora" "Advisor" %}:</h5>
      {% endif %}
      <div class="ml-1">
        &#8614;
        {% if user.eh_prof_a %}
          <a href="{% url 'professor_detail' projeto.orientador.id %}">{{projeto.orientador.user.get_full_name}}</a>
        {% else %}
          {{projeto.orientador.user.get_full_name}}
        {% endif %}
        <a href="mailto:{{projeto.orientador.user.email}}">
          <span class="texto-longo">&lt;{{projeto.orientador.user.email}}&gt;</span>
          <span class="texto-curto"><i class="far fa-envelope"></i></span>
        </a>
      </div>
    {% else %}
      <h4>{% lng "Orientador não definido" "Advisor not defined" %}</h4>
    {% endif %}

    {% if coorientadores %}
      <h6 class="mt-2 ml-2">
        <strong>{% lng "Coorientação" "Co-advisoring" %}:</strong>
      </h6>
      <div>
        <ul class="usuarios-stack">
        {% for coorientador in coorientadores %}
          <details class="usuario-item">
            <summary>
              <span class="coorientador-accent"></span>
              <div>
              <a href="{% url 'professor_detail' coorientador.usuario.professor.id %}">
                {{ coorientador.usuario.get_full_name }}
              </a>
              <a href="mailto:{{coorientador.usuario.email}}">
                <span class="texto-longo">&lt;{{coorientador.usuario.email}}&gt;</span>
                <span class="texto-curto"><i class="far fa-envelope"></i></span>
              </a>
              {% if coorientador.observacao %}
                <div class="ml-2">obs: {{coorientador.observacao}}</div>
              {% endif %}
              </div>
            </summary>
          </details>
        {% endfor %}
        </ul>
      </div>
    {% endif %}

    <hr>
    <h5 style="display: inline;">
      {% lng_n alocacoes.count "Estudante" "Estudantes" "Student" "Students" %}:
    </h5>
    {% if alocacoes %}
      <span class="emails esconder">
        <a href="mailto:{% for alocacao in alocacoes %}{{alocacao.aluno.user.email}}{% if not forloop.last %};{% endif %}{% endfor %}?subject=Capstone%20Insper%20-%20Projeto:%20{{projeto}}&body=Caro{% if alocacoes|length > 1 %}s{% endif %}%20{% for alocacao in alocacoes %}{% if not forloop.first %}{% if forloop.last %}%20e{% else %},{% endif %}%20{% endif %}{{alocacao.aluno.user.get_full_name}}{% endfor %},%0D%0A%0D%0Aatenciosamente,%20{{configuracao.coordenacao.coordenador_email}}%20(coordenação%20Capstone)" target="_blank">
          <i class="fas fa-mail-bulk"></i>
        </a>
      </span>
    {% endif %}
    <div class="mt-2">
      <ul class="usuarios-stack">
        {% for alocacao in alocacoes %}
          {% with notas=alocacao|get_notas_alocacao:request descontos=alocacao|get_descontos_alocacao:request %}
          <details class="usuario-item {% if alocacao.aluno.externo %}is-externo{% endif %}">
            <summary>
              <span class="aluno-accent"></span>
              <div>
                {% if user.eh_prof_a %}
                  <a href="{% url 'estudante_detail' alocacao.aluno.id %}">{{alocacao.aluno.user.get_full_name}}</a>
                {% else %}
                  {{alocacao.aluno.user.get_full_name}}
                {% endif %}
                <span class="texto-longo curso-chip"
                style="--chip-bg: #{{ alocacao.aluno.curso2.cor }};"
                >[{% lng alocacao.aluno.curso2.nome alocacao.aluno.curso2.nome_en %}]</span>
                <span class="texto-curto curso-chip" 
                style="--chip-bg: #{{ alocacao.aluno.curso2.cor }};"
                data-toggle="tooltip" data-html="true" animation="true" title="{{ alocacao.aluno.curso2}}">[{{ alocacao.aluno.curso2.sigla_curta }}]</span>
                <a href="mailto:{{alocacao.aluno.user.email}}">
                  <span class="texto-longo">&lt;{{alocacao.aluno.user.email}}&gt;</span>
                  <span class="texto-curto"><i class="far fa-envelope"></i></span>
                </a>
                {% if alocacao.aluno.externo %}<span style="color:red">[{{alocacao.aluno.externo}}]</span>{% endif %}
              </div>
              <div>
                {% if notas or descontos %}
                  <span class="badge badge-info unselectable">
                    <i class="fas fa-chart-bar"></i> {% lng "notas" "grades" %}
                  </span>
                {% else %}
                  <span class="text-muted unselectable" style="font-size: .85em;">{% lng "sem notas" "no grades" %}</span>
                {% endif %}
              </div>
            </summary>
            {% if notas or descontos %}
              <div class="aluno-extra">
                {% include "display_notas_individuais.html" with notas=notas descontos=descontos rubricas=False %}
              </div>
            {% endif %}
          </details>
          {% endwith %}
        {% empty %}
          <li class="usuario-item text-danger" style="padding: 8px 12px;">
            {% lng "Nenhum estudante alocado." "No student allocated." %}
          </li>
        {% endfor %}
      </ul>
    </div>

    

      {% if associados %}  
        
        <h5 style="display: inline;">
          {% lng_n associados.count "Estudante associado" "Estudantes associados" "Associated student" "Associated students" %}:
        </h5>
        <span class="emails esconder">
          <a href="mailto:{% for associado in associados %}{{associado.usuario.email}}{% if not forloop.last %};{% endif %}{% endfor %}?subject=Capstone%20Insper%20-%20Projeto:%20{{projeto}}&body=Caro{% if associados|length > 1 %}s{% endif %}%20{% for associado in associados %}{% if not forloop.first %}{% if forloop.last %}%20e{% else %},{% endif %}%20{% endif %}{{associado.usuario.get_full_name}}{% endfor %},%0D%0A%0D%0Aatenciosamente,%20{{configuracao.coordenacao.coordenador_email}}%20(coordenação%20Capstone)" target="_blank">
            <i class="fas fa-mail-bulk"></i>
          </a>
        </span>
        <div class="mt-1">
        <ul class="usuarios-stack mt-2">
        {% for associado in associados %}
          <details class="usuario-item {% if associado.estudante.externo %}is-externo{% endif %}" open>
            <summary>
              <span class="associado-accent"></span>
              <div>
                {% if user.eh_prof_a %}
                  <a href="{% url 'estudante_detail' associado.estudante.id %}">{{associado.estudante.user.get_full_name}}</a>
                {% else %}
                  {{associado.estudante.user.get_full_name}}
                {% endif %}
                <span class="texto-longo curso-chip"
                style="--chip-bg: #{{ associado.estudante.curso2.cor }};"
                >[{% lng associado.estudante.curso2.nome associado.estudante.curso2.nome_en %}]</span>
                <span class="texto-curto curso-chip" 
                style="--chip-bg: #{{ associado.estudante.curso2.cor }};"
                data-toggle="tooltip" data-html="true" animation="true" title="{{ associado.estudante.curso2}}">[{{ associado.estudante.curso2.sigla_curta }}]</span>

                <a href="mailto:{{associado.estudante.user.email}}">
                  <span class="texto-longo">&lt;{{associado.estudante.user.email}}&gt;</span>
                  <span class="texto-curto"><i class="far fa-envelope"></i></span>
                </a>

                {% if associado.estudante.externo %}<span style="color:red">[{{associado.estudante.externo}}]</span>{% endif %}
              </div>
              {% comment %} <div>
                <span class="badge badge-light">
                  {% lng 'associado' 'associated' %}
                </span>
              </div> {% endcomment %}
            </summary>
          </details>
        {% endfor %}
        </ul>
      {% endif %}


      {% if user.eh_prof_a and alocacoes|probations %}
        <div style="cursor: pointer; display: inline-block; background: #fff3cd; border: 2px solid #ffc107; border-radius: 6px; padding: 0.5em 0.5em; margin-left: 0.5em; box-shadow: 0 2px 8px rgba(255,193,7,0.15);">
          {% with parecer=projeto|get_parecer_de_probatorio %}
            <a class="open-modal" title="O parecer de probatório é único para o projeto e deve explicar a situação dos estudantes"
              data-toggle="tooltip" data-html="true" animation="true"
              {% if parecer %}
                style="color: #856404;"
                data-url="{% url 'adiciona_documento' projeto.organizacao.id projeto.id 'PPP' parecer.id %}"
              {% else %}
                style="color: red;"
                data-url="{% url 'adiciona_documento' projeto.organizacao.id projeto.id 'PPP' %}"
              {% endif %}
            >
              <span class="badge badge-warning" style="font-size: 1.1em; margin-right: 0.5em; margin-left: 0.0em;">
                <i class="fas fa-exclamation-triangle" style="color: #856404;"></i>
                {% lng "probatório" "probatory" %}
              </span>
              <span style="font-weight: bold; color: #856404;" class="mr-2">
                {% lng "Estudantes em probatório, orientador deve enviar parecer para a Banca de Probatório." "Students on probation, advisor must send opinion to the Probation Committee." %}
              </span>
              {% if parecer %}
                <i class="fas fa-file-alt"></i>
                {% lng "(clique para atualizar)" "(click to update)" %}</a>
                (<a href="{{request.scheme}}://{{request.get_host}}{{parecer.documento.url}}" target="_blank" rel="noopener noreferrer">
                  {% lng "Enviado" "Sent" %}: {{parecer}}
                </a>)
              {% else %}
                <i class="far fa-file"></i>
                {% lng "(clique para enviar)" "(click to send)" %}</a>
              {% endif %}
            
          {% endwith %}
        </div>
            
        {% comment %} href="{{request.scheme}}://{{request.get_host}}{{documento.documento.url}}" target="_blank" rel="noopener noreferrer" {% endcomment %}
        {% comment %} data-url="{% url 'adiciona_documento' projeto.organizacao.id projeto.id 'PO' documento.id %}" {% endcomment %}

      {% endif %}

    </div>


    {% if medias_oo %}
      <hr>
      <h4>{% lng "Médias de Grupo" "Group Averages" %}:</h4>

      <span class="medias-title">{% lng "Médias" "Averages" %}:</span>
      {% for key, value in medias_oo.media_grupo.items %}
        {% if value.media >= 0 %}
          <span class="badge badge-secondary" style="white-space: nowrap;">{% lng key.titulo key.titulo_en %} = {{value.media|stringformat:".1f"}}</span>
        {% endif %}
      {% endfor %}
      
      <span class="badge badge-info" style="white-space: nowrap;">
        {% lng "Média Grupo Geral" "General Group Average" %} =
        {{medias_oo.media_grupo_geral|stringformat:".1f"}}
      </span>
      <br>

      <div class="table-responsive">
        <div style="position: relative; height:203px; width:406px">
          <canvas id="radial-grupo"></canvas>
        </div>
      </div>

      <script>
        var config_radial_grupo = {
          type: "radar",
          data: {
              labels_pt: [{% for key, value in medias_oo.media_grupo.items %}{% if value.media >= 0 %}"{{key.titulo}}",{% else %}"",{% endif %}{% endfor %}],
              labels_en: [{% for key, value in medias_oo.media_grupo.items %}{% if value.media >= 0 %}"{{key.titulo_en}}",{% else %}"",{% endif %}{% endfor %}],
              datasets: [{
                  label: "Objetivos de Aprendizagem",
                  pointBackgroundColor: [{% for key, value in medias_oo.media_grupo.items %}"{{value.cor}}",{% endfor %}],
                  data: [{% for key, value in medias_oo.media_grupo.items %}
                          {% if value.media >= 0 %}{{value.media|stringformat:".2f"|unlocalize}},{% else %} null,{% endif %}
                        {% endfor %}],
                  scaleOverride: true,
                  pointRadius: 5,
                  backgroundColor: "rgba(0,0,240,0.1)",
                  },
              ]
          },
          options: {
              legend: { display: false },
              title: {
                  display: true,
                  text_pt: "Avaliação Grupo",
                  text_en: "Group Evaluation",
              },
              scale: {
                  responsive: true,
                  angleLines: {
                      display: false
                  },
                  ticks: {
                      beginAtZero: true,
                      suggestedMin: 0,
                      suggestedMax: 10
                  }
              },
          }
        }

        var radial_grupo = document.getElementById("radial-grupo").getContext("2d");
        window.medias = new Chart(radial_grupo, config_radial_grupo);

        function lingua_grafico() {
          if(localStorage.getItem("lingua") == "pt") {
            window.medias.options.title.text = window.medias.options.title.text_pt;
            window.medias.data.labels = window.medias.data.labels_pt;
          } else {
            window.medias.options.title.text = window.medias.options.title.text_en;
            window.medias.data.labels = window.medias.data.labels_en;
          }
          window.medias.update();
        }
        lingua_grafico();
        document.addEventListener("languageChanged", lingua_grafico);

      </script>

    {% endif %}

    {% if user.eh_prof_a %}
      {% if projeto|has_relatos %}  
        <hr>
        <h4>{% lng "Relatos Quinzenais" "Biweekly Reports" %}:</h4>
        {% include "relatos.html" with alocacoes=alocacoes|sem_externos %}
      {% endif %}
    {% endif %}

    {% if documentos or user.eh_prof_a %}
      <hr>
      <span class="d-flex align-items-center justify-content-between flex-wrap">
        <h4>
          {% lng "Documentos" "Documents" %}:
          {% if user.eh_prof_a %}
            {% if projeto and projeto.organizacao %}
              <small class="esconder">
                <a class="open-modal" style="cursor: pointer;" data-url="{% url 'adiciona_documento' projeto.organizacao.id projeto.id %}">&#10133;</a>
              </small>
            {% endif %}
          {% endif %}
        </h4>
        {% include "filtro_documentos.html" %}
      </span>
      <div class="caixa_rolante">
        {% include "documentos.html" %}
      </div>
    {% endif %}
    
    {% if projeto.get_site or projeto.pastas_do_projeto %}
      <div class="mt-3">
        {% include "professores/includes/ver_site.html" %}
        {% include "professores/includes/ver_pastas_projeto.html" %}
      </div>  
    {% endif %}
    
    {% with certificados=projeto.certificado_set.all %}
      {% if certificados or user.eh_admin %}
        <hr>
        <h4>
          {% lng "Certificados" "Certificates" %}:
          {% if user.eh_prof_a %}
            <small class="esconder">
              <a href="{% url 'carregar_certificado' %}">&#10133;</a>
            </small>
          {% endif %}
        </h4>
        <div class="caixa_rolante">
          {% include "certificados.html" with certificados=projeto.certificado_set.all %}
        </div>
      {% endif %}
    {% endwith %}

    {% if user.eh_prof_a %}
    {% if projeto.encontro_set.all %}
        <hr>
        <h4>{% lng "Mentorias" "Mentorships" %}:</h4>
        <ul class="mentoria-timeline">
          {% for dinamica in projeto.encontro_set.all %}
            <li class="mentoria-item">
              
              <div class="mentoria-card">
                <div class="mentoria-header">
                  <div class="mentoria-when">
                    <i class="far fa-calendar-alt"></i>
                    {{dinamica.startDate|date:'j \\d\\e F \\d\\e Y'}}
                    <span class="ml-1">
                      <i class="far fa-clock"></i>
                      {{dinamica.startDate|date:'H:i'}}–{{dinamica.endDate|date:'H:i'}}
                    </span>
                  </div>
                  <div class="mentoria-chips">
                    {% if dinamica.tematica %}
                      <span class="badge badge-pill badge-light border" title="Tem">  
                        {% comment %} {% lng 'Temática' 'Theme' %} {% endcomment %}
                        <i class="fas fa-tags"></i> {{dinamica.tematica.nome}}
                      </span>
                    {% endif %}
                    {% if dinamica.location %}
                      {% if dinamica.url_location %}
                        <a class="badge badge-pill badge-light border" href="{{dinamica.location}}" title="Link de videoconferência">
                          {% comment %} {% lng 'Link de vídeo' 'Video link' %} {% endcomment %}
                          <i class="fas fa-video"></i> {% lng "videoconferência" "videoconference" %}
                        </a>
                      {% else %}
                        <span class="badge badge-pill badge-light border" title="Localização">
                          {% comment %} {% lng 'Local' 'Location' %} {% endcomment %}
                          <i class="fas fa-map-marker-alt"></i> {{dinamica.location}}
                        </span>
                      {% endif %}
                    {% endif %}
                    {% if dinamica.facilitador %}
                      <a class="badge badge-pill badge-light border" href="{% url 'user_detail' dinamica.facilitador.id %}" title="Facilitador(a)">
                        {% comment %} {% lng 'Facilitador(a)' 'Facilitator' %} {% endcomment %}
                        <i class="fas fa-user"></i> {{dinamica.facilitador}}
                      </a>
                    {% endif %}
                    {% if dinamica.documento %}
                      <a class="badge badge-pill badge-light border" href="{{dinamica.documento.url}}">
                        <i class="fas fa-file-alt"></i> {% lng "Documento" "Document" %}
                      </a>
                    {% endif %}
                    {% if dinamica.link %}
                      <a class="badge badge-pill badge-light border" href="{{dinamica.link}}">
                        <i class="fas fa-link"></i> {% lng "Link" "Link" %}
                      </a>
                    {% endif %}
                  </div>
                </div>

                <div class="mentoria-body">
                  {% if dinamica.observacoes_estudantes %}
                    <div class="section">
                      <span class="title"><i class="fas fa-user-graduate"></i> {% lng "Observações para Estudantes" "Observations for Students" %}</span>
                      <div class="content">{{dinamica.observacoes_estudantes|safe|linebreaks}}</div>
                    </div>
                  {% endif %}

                  {% if dinamica.observacoes_orientador %}
                    <div class="section">
                      <span class="title"><i class="fas fa-chalkboard-teacher"></i> {% lng "Observações para Orientador" "Observations for Advisor" %}</span>
                      <div class="content">{{dinamica.observacoes_orientador|safe|linebreaks}}</div>
                    </div>
                  {% endif %}

                  {% if dinamica.feedback %}
                    <div class="section">
                      <span class="title"><i class="far fa-comment-dots"></i> {% lng "Feedback" "Feedback" %}</span>
                      <div class="content">{{dinamica.feedback|linebreaks}}</div>
                    </div>
                  {% endif %}

                  {% if dinamica.feedback_estudantes %}
                    <div class="section">
                      <span class="title"><i class="far fa-comments"></i> {% lng "Feedback dos Estudantes" "Students Feedback" %}</span>
                      <div class="content">{{dinamica.feedback_estudantes|linebreaks}}</div>
                    </div>
                  {% endif %}

                  {% if dinamica.feedback_orientador %}
                    <div class="section">
                      <span class="title"><i class="far fa-comment"></i> {% lng "Feedback do Orientador" "Advisor Feedback" %}</span>
                      <div class="content">{{dinamica.feedback_orientador|linebreaks}}</div>
                    </div>
                  {% endif %}
                </div>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endif %}

    
    {% if user.eh_prof_a %}
      <hr>
      <h4>{% lng "Alocação Semanal dos Estudantes" "Weekly Allocation of Students" %}:</h4>
      {% include "mostra_horarios.html" %}
    {% endif %}


    {% if user.eh_prof_a %}
      {% include "estudantes/includes/conduta_respostas.html" with grupo=True %}
      {% include "estudantes/includes/funcionalidade_respostas.html" with mostra_resultados=True %}
      {% include "estudantes/includes/pares_respostas.html" %}
    {% endif %}

    {% if user.eh_prof_a %}
      {% with despesas=projeto.despesa_set.all %}
        {% if despesas %}
          <hr>
          <h4>{% lng "Despesas Financeiras do Projeto" "Financial Expenses of the Project" %}:</h4>
          <ul>
            {% for despesa in projeto.despesa_set.all %}
              <li>
                {% if despesa.data %}{{despesa.data}}{% else %}{% lng "DATA INDEFINIDA" "UNDEFINED DATE" %}{% endif %}
                {% if despesa.descricao %} - [{{despesa.descricao}}]{% endif %}
                = 
                {% if despesa.valor_r %} R$ {{despesa.valor_r|stringformat:".2f"}}{% endif %}
                {% if despesa.valor_d %} U$ {{despesa.valor_d|stringformat:".2f"}}{% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}
    {% endif %}

    {% if user.eh_prof_a %}

      <hr>

      
      <div class="card mb-3 text-muted font-weight-bold">
        <div class="card-header py-1 pl-2">
          {% lng "Avaliações e Resultados" "Evaluations and Results" %}
        </div>
        <div class="card-body p-2">
  
        <a class="btn btn-primary wbtn"
          data-toggle="tooltip" data-html="true" animation="true" title="Permite avaliar as entregas do projeto"
          {% if projeto.orientador %}
          href="{% url 'avaliar_entregas' projeto.orientador.id %}?projeto={{projeto.id}}"
          {% else %}
          disabled
          {% endif %}
        >
          {% lng "Resultados Entregas" "Deliveries Results" %}
        </a>

        <a class="btn btn-primary wbtn"
          data-toggle="tooltip" data-html="true" animation="true" title="Acessa as avaliações das bancas"
          href="{% url 'resultado_bancas' %}?projeto={{projeto.id}}">
          {% lng "Resultado Bancas" "Exam. Boards" %}
        </a>

        <a class="btn btn-primary wbtn"
          data-toggle="tooltip" data-html="true" animation="true" title="Visualiza as avaliações de pares"
          {% if projeto.orientador %}
            href="{% url 'avaliacoes_pares' projeto.orientador.id projeto.id %}"
          {% else %}
            disabled
          {% endif %}
          >
            {% lng "Avaliação de Pares" "Peer Evaluation" %}
          </a>

        </div>
      </div>

      <div class="card mb-3 text-muted font-weight-bold">
        <div class="card-header py-1 pl-2">
          {% lng "Agendamentos" "Schedules" %}
        </div>
        <div class="card-body p-2">

          <a class="btn btn-primary wbtn"
            data-toggle="tooltip" data-html="true" animation="true" title="Acessa os agendamentos das bancas"
            href="{% url 'bancas_lista' projeto.id %}">
            {% lng "Bancas" "Exam. Boards" %}
          </a>

          <a class="btn btn-primary wbtn"
            data-toggle="tooltip" data-html="true" animation="true" title="Acessa os agendamentos das mentorias"
            href="{% url 'dinamicas_lista' projeto.id %}">
            {% lng "Mentorias" "Mentorships" %}
          </a>
  
        </div>
      </div>

      <div class="card mb-3 text-muted font-weight-bold">
        <div class="card-header py-1 pl-2">
          {% lng "Edições" "Editions" %}
        </div>
        <div class="card-body p-2">
          <a class="btn btn-primary wbtn"
            data-toggle="tooltip" data-html="true" animation="true" title="Acessa a poposta do projeto"
            href="{% url 'proposta_completa' projeto.proposta.id %}">
            {% lng "Proposta" "Proposal" %}
          </a>

          {% if projetos_avancados %}
            <a class="btn btn-primary wbtn" 
            data-toggle="tooltip" data-html="true" animation="true" title="Acessa a versão avançada desse projeto"
            href="{% url 'projeto_avancado' projeto.id %}">
              {% lng "Versão Avançada" "Advanced Version" %}
            </a>
          {% else %}
            <a class="btn btn-primary wbtn" 
            data-toggle="tooltip" data-html="true" animation="true" title="Cria uma versão avançada desse projeto"
            onclick="cria_avancado()" style="color:white;">
              {% lng "Cria Avançado" "Create Advanced" %}
            </a>
          {% endif %}
          
          <a class="btn btn-primary wbtn"
            data-toggle="tooltip" data-html="true" animation="true" title="Permite editar alguns campos do projeto"
            href="{% url 'editar_projeto' projeto.id %}">
            {% lng "Editar" "Edit" %}
          </a>
        </div>
      </div>

      {% if not projetos_avancados %}
        <script>
          function cria_avancado() {
            {% if user.eh_admin %} 
              if (confirm("Não existe uma versão avançada desse projeto, deseja criar?")) {
                window.open("{% url 'projeto_avancado' projeto.id %}");
              }
            {% else %}
              alert("Você não tem permissão para criar uma versão avançada desse projeto.");
            {% endif %}
          }
        </script>
      {% endif %}

      

    {% endif %}

  </div>

  {% if user.eh_prof_a %}
    {% include "base-modal.html" %}
  {% endif %}

{% endblock %}