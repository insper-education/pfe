{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 22 de Setembro de 2020
{% endcomment %}

{% block head %}

  {% load static %}
  
  {% load l10n %}

  <script src="{% static 'js/w3.js' %}"></script>
  <script src="{% static 'js/Chart.min.js' %}"></script>
  <script src="{% static 'js/chartjs-plugin-datalabels.js' %}"></script>

  {% comment %} Para chamar os Tooltips {% endcomment %}
  <script>{% include "tooltip.js" %}</script>

{% endblock %}

{% block content %}

    <span class="titulo">Evolução por Notas/Conceitos</span>

    {% comment %} Seletor da edição da pesquisa {% endcomment %}
    
    {% comment %}
    {% with sem_edicao=True %}
    {% with com_cursos=True %}
        {% include "edicoes.html" %}
    {% endwith %}
    {% endwith %}
    {% endcomment %}

    <div class="atualizar">
    <div class="container">

        <div style="width:860px;"> 
            <canvas id="chart-medias-individuais"></canvas>
            <canvas id="chart-medias-gerais"></canvas>
        </div>

        <script>
    
            var config_medias_individuais = {
                type: 'line',
                data: {
                    labels: [
                        {% for edicao in edicoes %}
                            "{{edicao}}",
                        {% endfor %}
                    ],
                    datasets: [
                        {% for media in medias_individuais %}
                            { 
                                data: [
                                    {% for nota in media.media %}
                                        {{nota|stringformat:".2f"|unlocalize}},
                                    {% endfor %}
                                ],
                                label: "{{media.curso}}",
                                borderColor: "{{media.cor}}",
                                fill: false,
                                spanGaps: true,
                            },
                        {% endfor %}
                    ]
                },
                options: {
                    title: {
                        display: true,
                        text: 'Evolução de notas individuais'
                    }, 
                    {% comment %} scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                max: 10
                            }
                        }]
                    } {% endcomment %}

                }
            }

    
            var config_medias_gerais = {
                type: 'line',
                data: {
                    labels: [
                        {% for edicao in edicoes %}
                            "{{edicao}}",
                        {% endfor %}
                    ],
                    datasets: [
                        {% for media in medias_gerais %}
                            { 
                                data: [
                                    {% for nota in media.media %}
                                        {{nota|stringformat:".2f"|unlocalize}},
                                    {% endfor %}
                                ],
                                label: "{{media.curso}}",
                                borderColor: "{{media.cor}}",
                                fill: false,
                                spanGaps: true,
                            },
                        {% endfor %}
                    ]
                },
                options: {
                    title: {
                        display: true,
                        text: 'Evolução médias gerais'
                    }, 
                    {% comment %} scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                max: 10
                            }
                        }]
                    } {% endcomment %}

                }
            }


            function carrega_pagina() {  

                // Chart do média individuais
                var chart_medias_individuais = document.getElementById('chart-medias-individuais').getContext('2d');
                window.medias = new Chart(chart_medias_individuais, config_medias_individuais);

                // Chart do média gerais
                var chart_medias_gerais = document.getElementById('chart-medias-gerais').getContext('2d');
                window.medias = new Chart(chart_medias_gerais, config_medias_gerais);

            }

            window.onload = carrega_pagina
        
        </script>


    </div>
    </div>

    {% comment %}
    {% with sem_edicao=True %}
    {% with com_cursos=True %}
        {% include "edicoes_ajax.html" %}
    {% endwith %}
    {% endwith %} 
    {% endcomment %}

{% endblock %}