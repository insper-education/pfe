{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 15 de Maio de 2019
{% endcomment %}

{% block head %}
  {% include "tabelas_includes.html" %}
{% endblock %}

{% block content %}

  <span class="titulo">Projetos</span>

  {% comment %} Seletor da edição da pesquisa {% endcomment %}
  {% include "edicoes.html" %}

  <div class="atualizar">
    {% if projetos %}
      <div class="table-responsive">
        <table id="ProjetosTable" class="table table-bordered table-hover table-sm">
          <thead class="table-info">
            <tr>
              <th scope="col" class="text-center">Projeto</th>
              <th scope="col" class="text-center">Período</th>
              <th scope="col" class="text-center">Orientador</th>
              <th scope="col" class="text-center">Organização</th>
            </tr>
          </thead>
          {% for projeto in projetos %} 
          <tr class="item">
              <th scope="row" data-order="{{projeto.get_titulo}}">
                <a href="{% url 'projeto_completo' projeto.id %}"
                  data-toggle="tooltip" data-html="true" animation="true" title="
                  {% for alocacao in projeto.alocacao_set.all %}
                    &bull; {{alocacao.aluno.user.get_full_name}} [{{alocacao.aluno.get_curso_display}}]<br>
                  {% empty %}
                    Nenhum aluno alocado nesse projeto
                  {% endfor %}
                  "            
                >
                  {% if projeto.titulo_final %}
                    {{projeto.titulo_final}}<br>
                    <small>Título Provisório: {{projeto.titulo}}</small>
                  {% else %}
                    {{projeto.titulo}}
                  {% endif %}
                </a>
              </th>
              <td class="text-center">
                  {{projeto.ano}}.{{projeto.semestre}}
              </td>
              <td>
                {% if projeto.orientador %}
                  <a href="{% url 'professor_detail' projeto.orientador.id %}">
                    {{ projeto.orientador }}
                  </a>
                {% else %}
                  <i>Orientador não definido</i>
                {% endif %}
              </td>
              <td>
                  <a href="{% url 'organizacao_completo' projeto.organizacao.id %}">
                    {{ projeto.organizacao.nome }}
                  </a>
              </td>
          </tr>          
          {% endfor %}
          
        </table>
      </div>
      {% comment %} <strong>Número Total de Projetos:</strong> {{ projetos.count }} {% endcomment %}
    {% endif %}
    <script>
      function carrega_pagina() {
        {% with tabela='Projetos' %}
          {% include "edicoes_ajax.js" %}
        {% endwith %}
      };
      function recarregar_pagina(){
        carrega_pagina();
      }
    </script>
  </div>
  <p>&nbsp;</p>

  <script>
    $(".filter").change(carrega_pagina);    
    $(document).ready(carrega_pagina);
  </script>

{% endblock %}