{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 22 de Setembro de 2020
{% endcomment %}

{% block head %}

  {% load static %}
  
  <script src="{% static 'js/w3.js' %}"></script>
  <script src="{% static 'js/Chart.min.js' %}"></script>
  <script src="{% static 'js/chartjs-plugin-datalabels.js' %}"></script>

  {% comment %} Para chamar os Tooltips {% endcomment %}
  <script>{% include "tooltip.js" %}</script>

{% endblock %}

{% block content %}
    <span class="titulo">Organizações, Projetos e Propostas</span>
    
    <div class="2areas2">

        <div id="canvas-holder">

            <canvas id="bar-projetos"></canvas>
            <small>
                <p>Recebemos <b>{{total_propostas}}</b> propostas de projetos no total.</p>
                <p>Realizados <b>{{total_projetos}}</b> projetos no total.</p>
            </small>
            <br>

            <canvas id="bar-organizacoes"></canvas>
            <small>
                <p>Recebemos propostas de <b>{{total_org_propostas}}</b> organizações distintas.</p>
                <p>Realizados projetos com <b>{{total_org_projetos}}</b> organizações distintas.</p>
                <p>Dados de prospecção até 2019.2 estão incompletos.</p>
            </small>
            <br><br>

        </div>

    </div>

    <script>
    
        var config_projetos = {
            type: 'bar',
            data: {
            labels: [
                {% for edicao in edicoes %}
                    "{{edicao}}",
                {% endfor %}
                ],
            datasets: [
                {
                label: "propostas",
                backgroundColor: "#8ebed2",
                data: [
                        {% for num in num_propostas %}
                            {{num}},
                        {% endfor %}
                    ]
                }, 
                {
                label: "projetos",
                backgroundColor: "#656efd",
                data: [
                        {% for num in num_projetos %}
                            {{num}},
                        {% endfor %}
                    ]
                }, 
            ]
            },
            options: {
                legend: { display: true },
                title: {
                    display: true,
                    text: 'Propostas e Projetos'
                },
                plugins: {
                    datalabels: {
                        color: '#000000'
                    }
                }
            }
        };

        var config_organizacoes = {
            type: 'bar',
            data: {
            labels: [
                {% for edicao in edicoes %}
                    "{{edicao}}",
                {% endfor %}
                ],
            datasets: [
                {
                    label: "prospectadas (semestre anterior)",
                    backgroundColor: "#ffe0f0",
                    data: [
                            {% for num in org_prospectadas %}
                                {{num}},
                            {% endfor %}
                        ]
                }, 
                {
                    label: "com proposta",
                    backgroundColor: "#e56883",
                    data: [
                            {% for num in org_propostas %}
                                {{num}},
                            {% endfor %}
                        ]
                },
                {
                    label: "com projeto",
                    backgroundColor: "#f84359",
                    data: [
                            {% for num in org_projetos %}
                                {{num}},
                            {% endfor %}
                        ]
                },
            ]
            },
            options: {
                legend: { display: true },
                title: {
                    display: true,
                    text: 'Organizações Envolvidas'
                },
                plugins: {
                    datalabels: {
                        color: '#000000',
                        font: function(context) {
                            var width = context.chart.width;
                            var size = Math.round(width / 45);

                            return {
                                size: size
                            };
                        }
                    },
                    
                }
            }
        };


        function carrega_semestre() {  
            // Chart da quantidade de projetos
            var bar_projetos = document.getElementById('bar-projetos').getContext('2d');
            window.projeto = new Chart(bar_projetos, config_projetos);

            // Chart da quantidade de organizacoes
            var bar_organizacoes = document.getElementById('bar-organizacoes').getContext('2d');
            window.organizacoes = new Chart(bar_organizacoes, config_organizacoes);
        }

        window.onload = carrega_semestre
    
    </script>


{% endblock %}