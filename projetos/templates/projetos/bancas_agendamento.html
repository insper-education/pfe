{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 26 de Novembro de 2019
{% endcomment %}

{% block head %}
  {% load escape_emails %}
{% endblock %}

{% block content %}
  <h3>Listagem de Bancas</h3>
  {% if bancas %}
    <table id="BancasTable">
      {% for banca in bancas %} 
      <tr class="item">
        <td>
        <a href="
          mailto:
          {% if banca.membro1 %}
            {{banca.membro1.first_name}}%20{{banca.membro1.last_name|parse_quote}}%20&lt;{{banca.membro1.email|parse_quote}}&gt;,
          {% endif %}
          {% if banca.membro2 %}
            {{banca.membro2.first_name}}%20{{banca.membro2.last_name|parse_quote}}%20&lt;{{banca.membro2.email|parse_quote}}&gt;,
          {% endif %}
          {% if banca.membro3 %}
            {{banca.membro3.first_name}}%20{{banca.membro3.last_name|parse_quote}}%20&lt;{{banca.membro3.email|parse_quote}}&gt;,
          {% endif %}
          {% for alocacao in banca.projeto.alocacao_set.all %}
            {{alocacao.aluno.user.first_name|parse_quote}}%20{{alocacao.aluno.user.last_name|parse_quote}}%20&lt;{{alocacao.aluno.user.email|parse_quote}}&gt;,
          {% endfor %}
          {{banca.projeto.orientador.user.first_name|parse_quote}}%20{{banca.projeto.orientador.user.last_name|parse_quote}}%20&lt;{{banca.projeto.orientador.user.email|parse_quote}}&gt;
          ?cc=Luciano%20Pereira%20Soares&lt;lpsoares@insper.edu.br&gt;,Comite%20PFE&lt;comitepfe@insper.edu.br&gt;
          &amp;subject=Banca%20PFE%20-%20Projeto:%20{% if banca.projeto.titulo_final %}{{banca.projeto.titulo_final|parse_quote}}{% else %}{{banca.projeto.titulo|parse_quote}}{% endif %}
          &amp;body=Caros,%0D%0A%0D%0A
          Agendamento%20para%20banca%20do%20PFE.%0D%0A%0D%0A
          Horário: {{banca.startDate.date}} ({{banca.startDate|date:'l'}}) das {{banca.startDate.time}}
          às {{banca.endDate.time}}%0D%0A
          {% if banca.tipo_de_banca == 0 %}
            Tipo: Final%0D%0A
          {% elif banca.tipo_de_banca == 1 %}
            Tipo: Intermediária%0D%0A
          {% endif %}
          {% if banca.projeto %}
            Título do Projeto:
              {% if banca.projeto.titulo_final %}
                {{banca.projeto.titulo_final|parse_quote}}
              {% else %}
                {{banca.projeto.titulo|parse_quote}}
              {% endif %}
          {% endif %}
          %0D%0A
          {% if banca.projeto.organizacao.nome %}
            Organização Parceira:
            {{ banca.projeto.organizacao.nome|parse_quote }}%0D%0A
          {% endif %}
          {% if banca.location %}
            Local: {{banca.location|parse_quote}}%0D%0A
          {% endif %}
          {% if banca.link %}
            Link: {{banca.link|parse_quote}}%0D%0A
          {% endif %}
          {% if banca.projeto.orientador %}
            %0D%0AOrientador:%0D%0A
              - {{banca.projeto.orientador.user.first_name|parse_quote}} 
              {{banca.projeto.orientador.user.last_name|parse_quote}} 
              %0D%0A%0D%0A
          {% endif %}
          Banca:%0D%0A
            {% if banca.membro1 %}
              - {{banca.membro1.first_name|parse_quote}} {{banca.membro1.last_name|parse_quote}}
            %0D%0A
            {% endif %}
            {% if banca.membro2 %}
              - {{banca.membro2.first_name|parse_quote}} {{banca.membro2.last_name|parse_quote}}
            %0D%0A
            {% endif %}
            {% if banca.membro3 %}
              - {{banca.membro3.first_name|parse_quote}} {{banca.membro3.last_name|parse_quote}}
            %0D%0A
            {% endif %}
          %0D%0A
          Alunos
          %0D%0A
            {% for alocacao in banca.projeto.alocacao_set.all %}
                - {{alocacao.aluno.user.first_name|parse_quote}} {{alocacao.aluno.user.last_name|parse_quote}}
                [{{ alocacao.aluno.get_curso_display|parse_quote }}]
              %0D%0A
            {% endfor %}
          %0D%0A%0D%0A
          atenciosamente,%20coordenação%20PFE
        ">
          <!--&amp;attach='events/{{banca.pk}}'-->
          {% if banca.startDate %}
            <b>Horário:</b> 
            {{banca.startDate.date}} ({{banca.startDate|date:"l"}}) das {{banca.startDate.time}}
          {% endif %}
          {% if banca.endDate %}
            às {{banca.endDate.time}}
          {% endif %}
          </a>
          <br>
          <a href="{% url 'event_ics_export' banca.id %}">
            <b>Agendamento eletrônico</b>: banca{{banca.id}}
          </a>
          <br>
          {% if banca.tipo_de_banca == 0 %}
            <b>Tipo:</b> Final<br>
          {% elif banca.tipo_de_banca == 1 %}
            <b>Tipo:</b> Intermediária<br>
          {% endif %}

          {% if banca.projeto %}
            <b>Título do Projeto:</b> 
              {% if banca.projeto.titulo_final %}
                {{banca.projeto.titulo_final}}<br>
              {% else %}
                {{banca.projeto.titulo}}</a>
              {% endif %}
            <br>
          {% endif %}
          
          {% if banca.projeto.organizacao.nome %}
            <b>Organização Parceira:</b> 
              {{ banca.projeto.organizacao.nome }}<br>
          {% endif %}
          
          {% if banca.location %}
            <b>Local:</b> {{banca.location}}<br>
          {% endif %}
          
          <b>Participantes:</b><br>
          <ul>
            {% if banca.projeto.orientador %}
              <li>
                {{banca.projeto.orientador.user.get_full_name}} [orientador(a)]
                <a href="mailto:{{banca.projeto.orientador.user.email}}"> &lt;{{banca.projeto.orientador.user.email}}&gt;</a><br>
              </li>
            {% endif %}
            {% if banca.membro1 %}
              <li>
                {{banca.membro1.get_full_name}} [banca]
                <a href="mailto:{{banca.membro1.email}}"> &lt;{{banca.membro1.email}}&gt;</a><br>
              </li>
            {% endif %}
            {% if banca.membro2 %}
              <li>
                {{banca.membro2.get_full_name}} [banca]
                <a href="mailto:{{banca.membro2.email}}"> &lt;{{banca.membro2.email}}&gt;</a><br>
              </li>
            {% endif %}
            {% if banca.membro3 %}
              <li>
                {{banca.membro3.get_full_name}} [banca]
                <a href="mailto:{{banca.membro3.email}}"> &lt;{{banca.membro3.email}}&gt;</a><br>
              </li>
            {% endif %}
            {% for alocacao in banca.projeto.alocacao_set.all %}
                <li>
                  {{alocacao.aluno.user.get_full_name}} [estudante]
                  <a href="mailto:{{alocacao.aluno.user.email}}"> &lt;{{alocacao.aluno.user.email}}&gt;</a><br>
                </li>
            {% endfor %}
          <ul>
        </td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>Não existem bancas futuras agendadas.</p>
  {% endif %}
  <p>&nbsp;</p>

{% endblock %}