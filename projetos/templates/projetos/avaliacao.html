{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 10 de Abril de 2020
{% endcomment %}

{% block head %}

  {% load banca_tipo %}

  <style>
    textarea {
      max-width:100%;
    }
  </style>

{% endblock %}

{% block content %}
  {% if banca %}
    <form method="post" id="avaliacaoform" enctype="multipart/form-data">
      {% csrf_token %}

      <b>Título do Projeto:</b> {{banca.projeto.titulo}}<br>
      <b>Organização:</b> {{banca.projeto.organizacao}}<br>
      <b>Orientador{% if banca.projeto.orientador.user.genero == "F" %}a{% endif %}:</b> {{banca.projeto.orientador}}<br>
      <b>Grupo:</b>
      <ul>
        {% for alocacao in banca.projeto.alocacao_set.all %}
          <li>
            {% comment %} <a href="{% url 'aluno_detail' alocacao.aluno.id %}">{% endcomment %} 
              {{alocacao.aluno.user.get_full_name}}
            {% comment %} </a>
            <a href="mailto:{{alocacao.aluno.user.email}}">&lt;{{alocacao.aluno.user.email}}&gt;</a>
            {% endcomment %} 
            [{{ alocacao.aluno.get_curso_display }}]
          </li>
        {% endfor %}
      </ul>

      {% if banca.tipo_de_banca is not None %}
        <b>Banca:</b>
        {{ banca.tipo_de_banca|get_banca }}
        <br>
      {% endif %}

      <br>
      <b>Data:</b> {{banca.startDate|date:"DATE_FORMAT"}} das {{banca.startDate|date:"H:i"}} às {{banca.endDate|date:"H:i"}}<br>
      {% if banca.location %}
        <b>Local:</b> {{banca.location}}<br>
      {% endif %}  
      {% if banca.link %}
        <b>Link:</b> <a href="{{banca.link}}">{{banca.link}}</a>
        <br>
      {% endif %}
      
      <br><b><label for="avaliador">Avaliador(a)</label></b>:
      <select name="avaliador" id="avaliador" title="Selecione avaliador da banca" required
        oninvalid="this.setCustomValidity('Selecione seu nome para o controle das avaliações')"
        oninput="this.setCustomValidity('')"
        >
          <option disabled selected value> -- selecione um avaliador -- </option>
          {% for pessoa in pessoas %}
            <option value="{{pessoa.id}}" {% if pessoa.id == avaliador %}selected{% endif %}>
              {{pessoa.get_full_name}}
            </option>   {% if projeto.id == banca.projeto.id %} selected="selected" {% endif %}
          {% endfor %}
      </select>
      <br><br>

      {% if orientacoes %}
        <h5>Orientações Gerais</h5>
        {{orientacoes|safe}}
        <br>
      {% endif %}

      {% if objetivos %}
        <br><h5>Objetivos de Aprendizagem</h5>
        {% for objetivo in objetivos %}
          <b>{{objetivo.titulo}}</b>: {{objetivo.objetivo}}
          <table style="width:100%">
            <tr>
              <th class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}NA" style="width:10%;">
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}NA" id="objetivo.{{forloop.counter}}{{objetivo.id}}.NA" name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.NA" required> 
                 <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.NA">N/A</label>
              </th>
              <th class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}I" style="width:18%">
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}I" id="objetivo.{{forloop.counter}}{{objetivo.id}}.I " name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.I " required
                {% for obj, conceito in conceitos %}
                  {% if obj == objetivo.id and conceito == "I" %}
                    checked="checked"
                  {% endif %}
                {% endfor %}
                >
                <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.I ">Insatisfatório (I)</label>
              </th>
              <th class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}D" style="width:18%">
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}D" id="objetivo.{{forloop.counter}}{{objetivo.id}}.D " name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.D " required
                {% for obj, conceito in conceitos %}
                  {% if obj == objetivo.id and conceito == "D" %}
                    checked="checked"
                  {% endif %}
                {% endfor %}
                >
                <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.D ">Em Desenvolvimento (D)</label>
              </th>
              <th class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}C" style="width:18%">
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}C" id="objetivo.{{forloop.counter}}{{objetivo.id}}.C " name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.C " required
                {% for obj, conceito in conceitos %}
                  {% if obj == objetivo.id and conceito == "C" %}
                    checked="checked"
                  {% endif %}
                {% endfor %}
                >
                <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.C ">Essencial (C)</label>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}C" id="objetivo.{{forloop.counter}}{{objetivo.id}}.C+" name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.C+" required
                {% for obj, conceito in conceitos %}
                  {% if obj == objetivo.id and conceito == "CX" %}
                    checked="checked"
                  {% endif %}
                {% endfor %}
                >
                <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.C+">(C+)</label>
              </th>
              <th class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}B" style="width:18%">
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}B" id="objetivo.{{forloop.counter}}{{objetivo.id}}.B " name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.B " required
                {% for obj, conceito in conceitos %}
                  {% if obj == objetivo.id and conceito == "B" %}
                    checked="checked"
                  {% endif %}
                {% endfor %}
                >
                <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.B ">Proficiente (B)</label>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}B" id="objetivo.{{forloop.counter}}{{objetivo.id}}.B+" name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.B+" required
                {% for obj, conceito in conceitos %}
                  {% if obj == objetivo.id and conceito == "BX" %}
                    checked="checked"
                  {% endif %}
                {% endfor %}
                >
                <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.B+">(B+)</label>
              </th>
              <th class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}A" style="width:18%">
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}A" id="objetivo.{{forloop.counter}}{{objetivo.id}}.A " name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.A " required
                {% for obj, conceito in conceitos %}
                  {% if obj == objetivo.id and conceito == "A" %}
                    checked="checked"
                  {% endif %}
                {% endfor %}
                >
                <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.A ">Avançado (A)</label>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <input type="radio" class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}A" id="objetivo.{{forloop.counter}}{{objetivo.id}}.A+" name="objetivo.{{ forloop.counter }}" value="{{objetivo.id}}.A+" required
                {% for obj, conceito in conceitos %}
                  {% if obj == objetivo.id and conceito == "AX" %}
                    checked="checked"
                  {% endif %}
                {% endfor %}
                >
                <label for="objetivo.{{forloop.counter}}{{objetivo.id}}.A+">(A+)</label>
              </th>
            </tr>
            <tr>
              <td class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}NA"><label for="objetivo.{{forloop.counter}}{{objetivo.id}}.NA">caso prefira não avaliar este objetivo, selecione esta coluna.</label></td>
              <td class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}I"><label for="objetivo.{{forloop.counter}}{{objetivo.id}}.I ">{{objetivo.rubrica_I}}</label></td>
              <td class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}D"><label for="objetivo.{{forloop.counter}}{{objetivo.id}}.D ">{{objetivo.rubrica_D}}</label></td>
              <td class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}C"><label for="objetivo.{{forloop.counter}}{{objetivo.id}}.C ">{{objetivo.rubrica_C}}</label></td>
              <td class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}B"><label for="objetivo.{{forloop.counter}}{{objetivo.id}}.B ">{{objetivo.rubrica_B}}</label></td>
              <td class="tabela{{forloop.counter}} objetivo{{forloop.counter}}{{objetivo.id}}A"><label for="objetivo.{{forloop.counter}}{{objetivo.id}}.A ">{{objetivo.rubrica_A}}</label></td>
            </tr>
          </table><br>
        {% endfor %}

      {% else %}
        <span class="red-bold">Não foram definidos Objetivos de Aprendizagem para essa Avaliação.</span><br>
      {% endif %}
      
      <br><b>Observações:</b><br>
      <textarea name="observacoes" rows="8" cols="80" maxlength="2048">{{observacoes}}</textarea>
      
      <br><br>
      <button type="submit">Enviar Avaliação</button>
      <p>&nbsp;</p>
    </form>
  {% else %}
    <p>Não existe projeto disponível para avaliar.</p>
  {% endif %}
  <p>&nbsp;</p>
  
  <script>

    function cores(e) {
      $("."+e.target.classList[0]).css('backgroundColor', '#FFFFFF');
      $("."+e.target.classList[1]).css('backgroundColor', '#DDDDFF');
    }

    $('input[type="radio"]').on('click change', cores);
    
  </script>

{% endblock %}