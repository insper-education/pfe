{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 17 de Dezembro de 2019
{% endcomment %}

{% block head %}
  {% load static %}
  {% load aderencia_aluno %}
  <script src="https://www.w3schools.com/lib/w3.js"></script>
  <script>
    $(document).ready(function(){
      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>
  
  <style>

    th.bottom {
      vertical-align:bottom;
    }

    th.rotate {
      height: 140px;
      white-space: nowrap;
    }

    th.rotate > div {
      transform: 
        /* Magic Numbers */
        translate(13px, 55px)
        /* 45 is really 360 - 45 */
        rotate(300deg);
      width: 26px;
    }

    th.rotate > div > span {
      border-bottom: 1px  solid black;
      padding: 1px 0px;
    }

    table, th {
      border-collapse: collapse;
      border: 0px solid black;
      padding-left: 2px;
      padding-right: 2px;
      text-align: center;
      font-size: 16px;
    }

    a.prioridade {
      color: inherit;
    }

  </style>

{% endblock %}

{% block content %}
  <h3>Projetos {{configuracao.ano}}.{{configuracao.semestre}}</h3>
  {% if projetos %}
    <table id="MapeamentoTable">
      <tr>
        <th onclick="w3.sortHTML('#MapeamentoTable', '.item', 'td:nth-child(1)')" style="cursor:pointer" class="bottom">Estudante</th>
        <th onclick="w3.sortHTML('#MapeamentoTable', '.item', 'td:nth-child(2)')" style="cursor:pointer" class="bottom">Eng</th>
        <th onclick="w3.sortHTML('#MapeamentoTable', '.item', 'td:nth-child(3)')" style="cursor:pointer" class="bottom">CR</th>
        {% for projeto in projetos %}   
          <th onclick="w3.sortHTML('#MapeamentoTable', '.item', 'td:nth-child({{ forloop.counter|add:"3" }})')" style="cursor:pointer;
          {% if not projeto.disponivel %}color:lightgray;{% endif %}"
          class="rotate">
            <div>
              <span>
                {{projeto.empresa.sigla}}
              </span>
            </div>
          </th>
        {% endfor %}
      </tr>      
      {% for estudante,opcoes in estudantes %} 
        <tr class="item">
          <td style="text-align:right">
            <a href="{% url 'aluno_detail' estudante.id %}">
              {{estudante.user.get_full_name}}
            </a>
          </td>
          <td style="text-align:center">
            <a href="{% url 'aluno_detail' estudante.id %}">
              {{estudante.curso}}
            </a>
          </td>
          <td style="text-align:left;border-right: 2px solid black;">
            <a href="{% url 'aluno_detail' estudante.id %}">
              {{estudante.cr|floatformat:4}}
            </a>
          </td>
          {% for opcao in opcoes %}
            {% if opcao %}
              <td style="text-align:center;
                  {% if opcao.projeto == estudante.alocacao_set.last.projeto %}background-color:pink;{% endif %}"
                  class="{% if opcao.prioridade == 0 %}red-bold{% elif opcao.prioridade <= 5 %}green-bold{% else %}yellow-bold{% endif %}">
                <a class="prioridade" href="{% url 'completo' opcao.projeto.id %}"
                  data-toggle="tooltip" data-html="true" animation="true" title="
                  {{ opcao.projeto.get_titulo }}
                  "
                >
                  {% if opcao.prioridade == 0 %}
                    X
                  {% else %}
                    {{opcao.prioridade}}
                  {% endif %}
                </a>
              </td>
            {% else %}
              <td>&nbsp;</td>
            {% endif %}
          {% endfor %}
        </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>Não existem projetos disponíveis.</p>
  {% endif %}
  <p>&nbsp;</p>

  <script>
    {% for projeto in projetos %}
      {% if not projeto.disponivel %}  
        $('table td:nth-child({{ forloop.counter|add:"3" }})').css('border','dotted 2px gray');
      {% endif %}
    {% endfor %}
  </script>

{% endblock %}