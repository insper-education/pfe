{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 17 de Julho de 2020
{% endcomment %}

{% block head %}
  {% load static %}
  <script src="https://www.w3schools.com/lib/w3.js"></script>
{% endblock %}

{% block content %}

  <span class="titulo">Projetos</span>
  <br>

  <label for="filter">Edição:</label>
  <select id="filter" class="filter" data-tableId="projetos">
    {% for loop in loop_anos %}
      <option value="{{loop}}.2" {% if ano == loop and semestre == 2 %}selected{% endif %}>{{loop}}.2</option>
      <option value="{{loop|add:1}}.1" {% if ano == loop|add:1 and semestre == 1 %}selected{% endif %}>{{loop|add:1}}.1</option>
    {% endfor %}
  </select>

<table  id="ProjetosTable" class="projetos">
  <tr>
    <td colspan="2">
    </td>
    <td colspan="2" class="text-center">
    <b>Banca</b>
    </td>
  </tr>
  <tr>
      <th onclick="w3.sortHTML('#ProjetosTable', '.item', 'td:nth-child(1)')" style="cursor:pointer" class="text-center">Projeto</th>
      <th onclick="w3.sortHTML('#ProjetosTable', '.item', 'td:nth-child(2)')" style="cursor:pointer" class="text-center">Organização</th>
      <th onclick="w3.sortHTML('#ProjetosTable', '.item', 'td:nth-child(3)')" style="cursor:pointer" class="text-center">Inter.</th>
      <th onclick="w3.sortHTML('#ProjetosTable', '.item', 'td:nth-child(4)')" style="cursor:pointer" class="text-center">Final</th>
      {% comment %}<th onclick="w3.sortHTML('#ProjetosTable', '.item', 'td:nth-child(2)')" style="cursor:pointer" class="text-center">Orientador</th>{% endcomment %}
    </tr>      
    {% for projeto, banca_intermediaria, banca_final in mylist %} 

    <tr class="item">
        <td>
          <a href="{% url 'projeto_completo' projeto.id %}">
          {{projeto.get_titulo}}<br>
          </a>
        </td>
        <td>
            <a href="{% url 'organizacao_completo' projeto.organizacao.id %}">
              {{ projeto.organizacao.nome }}
            </a>
        </td>
        <td class="text-center">
          <a href="{% url 'conceitos_obtidos' projeto.id %}">
            {{banca_intermediaria}}
          </a>
        </td>
        <td class="text-center">
          <a href="{% url 'conceitos_obtidos' projeto.id %}">
            {{ banca_final }}
          </a>
        </td>
        {% comment %}
        <td>
            <a href="{% url 'professor_detail' projeto.orientador.id %}">
              {{ projeto.orientador }}
            </a>
        </td>
        {% endcomment %}
    </tr>

    {% empty %}
      <tr><td colspan="4">
      Não existem projetos disponíveis.
      </td></tr>
    {% endfor %}
    
  </table>
  <p>&nbsp;</p>


  <script>
  
    function carrega_semestre(){
        var anosemestre = $(".filter option:selected").attr("value");
        $.ajax({
            type: "POST",
            url: "{% url 'resultado_avaliacoes' %}",
            data: {
                anosemestre: anosemestre,
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            success: function(response){
                $("table.projetos").replaceWith($("table.projetos",response));
                chart()
            },
            error: function(response) {
                console.log('error')
            }
        });
    }

    //window.onload = chart;
    //window.addEventListener("resize", chart);
    $(".filter").change(carrega_semestre);    
    $(document).ready(carrega_semestre);

  </script>

{% endblock %}
