{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 8 de Junho de 2021
{% endcomment %}

{% block head %}


  {% load static %}
  <link rel="stylesheet" href="{% static 'bootstrap-select-1.13.14/dist/css/bootstrap-select.min.css' %}">
  <script src="{% static 'bootstrap-select-1.13.14/dist/js/bootstrap-select.min.js' %}"></script>

  {% load index %}

  <style>
    textarea {
      max-width:100%;
    }
  </style>
{% endblock %}

{% block content %}

  <span class="titulo">Edição de Projeto</span>

  <form method="post"> {% csrf_token %}  

    <label for="titulo">Título Original:</label><br>
    <input type="text" size="80" maxlength="160" id="titulo_original" name="titulo_original" value="{{projeto.titulo}}" disabled>
    <br><br>

    <label for="titulo">Título:</label><br>
    <input type="text" size="80" maxlength="160" id="titulo" name="titulo"
    value="{% if projeto.titulo_final %}{{projeto.titulo_final}}{% else %}{{projeto.titulo}}{% endif %}">
    <br><br>

    <label for="descricao">Descrição do Projeto</label><br>
    <textarea id="descricao" name="descricao" rows="10" cols="80" maxlength="3000"
    >{% if projeto.descricao %}{{projeto.descricao}}{% else %}{{projeto.proposta.descricao}}{% endif %}</textarea>
    <br><br>

    <label for="orientador">Orientador(a)</label></b>:
    <select class="selectpicker show-tick" name="orientador" id="orientador" title="Selecione orientador do projeto"
    data-width="560px">
        <option selected value> -- selecione um orientador(a) -- </option>
        <optgroup label="Comitê PFE">
        {% for orientador in professores %}
          {% if orientador.user.membro_comite %}
            <option value="{{orientador.id}}" {% if orientador.id == projeto.orientador.id %}selected{% endif %}>
            {{orientador.user.get_full_name}}
          </option>
          {% endif %}
        {% endfor %}
        </optgroup>

        <optgroup label="Professores">
        {% for orientador in professores %}
          {% if not orientador.user.membro_comite %}
            <option value="{{orientador.id}}" {% if orientador.id == projeto.orientador.id %}selected{% endif %}>
            {{orientador.user.get_full_name}}
          </option>  
          {% endif %}
        {% endfor %}
        </optgroup>

    </select>
    <br>

    <label for="coorientador"><small>Coorientador(a)</small></label></b>:
    <select class="selectpicker show-tick" name="coorientador" id="coorientador" title="Selecione coorientador do projeto"
    data-width="560px">
        <option selected value> -- selecione um coorientador(a) -- </option>
        {% for professor in professores %}
          <option value="{{professor.user.id}}" {% if professor.user.id == coorientadores.last.usuario.id %}selected{% endif %}>
            {{professor.user.get_full_name}}
          </option>  
        {% endfor %}
    </select>
    <br><br>

    Grupo:<br>
    {% for membro in '0123'|make_list %}
      {% with alocacao=alocacoes|index:forloop.counter0 %}
        &nbsp;&nbsp;<label for="estudante{{forloop.counter}}">Estudante <span style="width:1em;text-align:left;display:inline-block;">{{forloop.counter}}</span></label></b>:
        <select class="selectpicker show-tick estudantes" name="estudante{{forloop.counter}}" id="estudante{{forloop.counter}}" title="Selecione estudante membro do projeto"
        data-live-search="true" data-width="560px">
            <option selected value> -- selecione um estudante -- </option>
            <optgroup label="Semestre PFE">
            {% for estudante in estudantes %}
              {% if estudante %}
                <option value="{{estudante.id}}" {% if estudante.id == alocacao.aluno.id %}selected{% endif %}>
                {{estudante.user.get_full_name}}
              </option>  
              {% endif %}
            {% endfor %}
            </optgroup>
        </select>
        <br>
      {% endwith %}
    {% endfor %}

    <br>
    <input type="checkbox" id="time_misto" name="time_misto" value="True" {% if projeto.time_misto %}checked{% endif %}>
    <label for="time_misto"> Time Misto (com estudantes de outra instituição)</label><br>  

    <br><br>

    <input id="submit" type="submit" value="Atualizar Projeto">
    <span id="mensagem"></span>
    
  </form>

  <script>

    $(".estudantes").change(function(){
      var estudantes  = $('.estudantes > select')
      var dic = {};
      for(est in estudantes){
        var chave = estudantes.eq(est).val()
        if(typeof chave !== "undefined" && chave != "") {
          if(chave in dic) {
            $("#submit").prop("disabled",true);
            $("#mensagem").html("Os estudantes devem ser diferentes");
            return;
          } else {
            dic[chave] = true;
          }
        }
      }
      $("#submit").prop("disabled",false);
      $("#mensagem").html("");
    });  

  </script>


  <p>&nbsp;</p>

{% endblock %}