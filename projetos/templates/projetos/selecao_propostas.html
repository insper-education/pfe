{% extends "base.html" %}
{% comment %}
    Desenvolvido para o Projeto Final de Engenharia
    Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
    Data: 15 de Maio de 2019
{% endcomment %}

{% block head %}
{% endblock %}

{% block content %}

    {% if ano != user.aluno.anoPFE or semestre != user.aluno.semestrePFE %}
       <h2 class="red-bold">Você não está registrado para o PFE em {{ano}}.{{semestre}}</h2>
       <h3 class="red-bold">Caso acredite que existe algum erro na informação, por favor contactar a coordenação do PFE</h3>
       <br>
    {% endif %}
    
    <h3>Projetos Disponíveis</h3>

    {% if propostas %}
      <form action="" method="post"> {% csrf_token %}  
        <table>
          {% for proposta in propostas %} 
            {% if proposta.disponivel %}
              <tr>
                <td>
                  <select id="selection{{proposta.pk}}" name="selection{{proposta.pk}}" ></select>
                  <script type="text/javascript">
                    var select = document.getElementById("selection{{proposta.pk}}");
                    select.options[select.options.length] = new Option("--", 0);
                    for(var index=1; index<={{propostas|length}}; index++){
                      select.options[select.options.length] = new Option(index, index);
                    }

                    // Para agora nao encontrei forma mais inteligente de fazer isso
                    {% for opc in opcoes_list %} 
                      {% if opc.proposta.pk == proposta.pk %}
                      select.selectedIndex = {{ opc.prioridade }};
                      {% endif %}
                    {% endfor %}

                  </script>
                </td>
                <td>
                  <a href="{% url 'proposta_detalhes' proposta.pk %}">
                    {% if proposta.titulo_final %}
                      {{proposta.titulo_final}}<br>
                      <small>Título Provisório: {{proposta.titulo}}</small>
                    {% else %}
                      {{proposta.titulo}}
                    {% endif %}
                    <font color="darkblue">({{ proposta.organizacao.nome }})</font>
                  </a>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </table>
        <p>&nbsp;</p>

        <font color="red">
          {{warnings|linebreaks}}
        </font>

        <input type="submit" value="Enviar">

        <small><font color="red">
          Selecione ao menos 5 projetos (1 ao 5), sendo 1 o que você tem mais interesse.
        </font></small>

        <p>&nbsp;</p>
        <p>&nbsp;</p>

      </form>

    {% else %}
      <p>Não existem projetos disponíveis.</p>
    {% endif %}

{% endblock %}