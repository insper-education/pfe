{% extends "base.html" %}
{% comment %}
  Desenvolvido para o Projeto Final de Engenharia
  Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
  Data: 22 de Novembro de 2019
{% endcomment %}

{% block head %}
  {% load static %}
  {% load exibe_notas %}
  <link rel="stylesheet" href="{% static 'css/div_arrend.css' %}">
{% endblock %}

{% block content %}

  {% if mensagem %}
    <h5 class="red-bold">{{mensagem}}</h5>
  {% endif %}

  {% if bancas %}
    {% for banca in bancas.reverse %} 
      <div class="div_arredondado">
          {% if banca.startDate %}
            <b>
              <span lang="pt">Horário:</span>
              <span lang="en" style="display: none;">Time:</span>
            </b> {{banca.startDate.date}} ({{banca.startDate|date:"l"}}) das {{banca.startDate.time}}
          {% endif %}
          {% if banca.endDate %}
            às {{banca.endDate.time}}
          {% endif %}
          <div>
            <b>
              <span lang="pt">Tipo:</span>
              <span lang="en" style="display: none;">Type:</span>
            </b> 
            <span lang="pt">{{banca.composicao.exame.titulo}}</span>
            <span lang="en" style="display: none;">{{banca.composicao.exame.titulo_en}}</span>
          </div>
          
          {% include "cabecalho_projeto.html" with projeto=banca.get_projeto com_email=True com_semestre=True %}
        
          {% if banca.location %}
            <div style="margin-top: 0px;"><b>Local:</b> {{banca.location}}</div>
          {% endif %}

          <div class="mt-2">
            <b>
              <span lang="pt">Membros da Banca:</span>
              <span lang="en" style="display: none;">Examination Board Members:</span>
            </b>
            {% include "membros_da_banca.html" %}

            {% if user.tipo_de_usuario != 1 or banca|exibe_notas_banca %} {% comment %} Filtra certas avaliações para estudantes não verem {% endcomment %}
              {% with avaliacao=banca.get_avaliacoes_bancas %}
                {% if avaliacao.objetivos %}
                  <hr>
                  <b>
                    <span lang="pt">Média dos Conceitos da Banca:</span>
                    <span lang="en" style="display: none;">Board's Average Grades:</span>
                  </b><br>
                  {% for objetivo, avaliacao in avaliacao.objetivos.items %}
                    &nbsp;&#x21A3; {{objetivo.titulo}}: 
                      {% if banca.alocacao %} {% comment %} PROBATION {% endcomment %}
                        {% if avaliacao.0 >= 5 %}
                          <span style="color: green;">
                            <span lang="pt">Suficiente</span>
                            <span lang="en" style="display: none;">Sufficient</span>
                          </span>
                        {% else %}
                          <span style="color: red;">
                            <span lang="pt">Insuficiente</span>
                            <span lang="en" style="display: none;">Insufficient</span>
                          </span>
                        {% endif %}
                      {% else %}
                        {% if avaliacao.0 >= 5 %}
                          <span style="color: black;">{{avaliacao.0|floatformat:2}}</span>
                        {% else %}
                          <span style="color: red;">{{avaliacao.0|floatformat:2}}</span>
                        {% endif %}
                      {% endif %}
                    <br>
                  {% endfor %}
                  {% if avaliacao.peso > 0 %}
                    &#10149;
                    <b> 
                      <span lang="pt">Nota final</span>
                      <span lang="en" style="display: none;">Final Grade</span>
                      = {{avaliacao.nota|floatformat:2}}
                    </b><br>
                  {% endif %}
                  {% comment %} <small>Obs: Os conceitos e notas da banca vão variar conforme membros da banca postam suas avaliações.<br></small> {% endcomment %}
                {% endif %}

                {% with observacoes_estudantes=banca.get_observacoes_estudantes %}
                  {% if observacoes_estudantes %}
                    <b style="display: inline-block; margin-top: 14px;">
                      <span lang="pt">Observações realizadas pelos membros da banca:</span>
                      <span lang="en" style="display: none;">Observations made by the examination board members:</span>
                    </b>
                    {% for observacao in observacoes_estudantes %}
                      {% if observacao.observacoes_estudantes %}
                      <div class="pintern" style="padding: 6px;">
                          <b>{{observacao.avaliador.get_full_name}}</b>:<br>
                          {{observacao.observacoes_estudantes|linebreaks}}
                      </div>
                      {% endif %}
                    {% endfor %}
                  {% endif %}      
                {% endwith %}
     
              {% endwith %}
            {% endif %}
          </div>

          
        </div>
      {% endfor %}
  
  {% else %}
    <p>
      <span lang="pt">Não existem bancas agendadas para você.</span>
      <span lang="en" style="display: none;">There are no scheduled examination boards for you.</span>
    </p>
  {% endif %}
  
{% endblock %}