{% extends "base.html" %}
{% comment %}
  Desenvolvido para o Projeto Final de Engenharia
  Autor: Luciano Pereira Soares <lpsoares@insper.edu.br>
  Data: 15 de Dezembro de 2023
{% endcomment %}

{% load static %}
{% load linguas %}

{% block head %}
  {% include "reload.html" %}
  {% include "tabelas_includes.html" %}
{% endblock %}

{% block content %}

  {% include "edicoes.html" %}

  {% include "botao_adiciona.html" with url_add="proposta_submissao" txt_pt="Adicionar Proposta" txt_en="Add Proposal" %}

  {% comment %} Tabela com todos as propostas selecionadas pelo filtro {% endcomment %}
  <div id="atualizar">
    {% include "tabelas_top_ml.html" with tabela="Propostas" cabecalhos=cabecalhos %}
      {% for proposta in propostas %} 
        <tr class="item"> 
          <th scope="row"><a href="{% url 'proposta_completa' proposta.id %}">{{proposta.titulo}}</a></th>
          <td class="text-center periodo">{{proposta.get_edicao}}</td>

          <td>
            {% if proposta.organizacao %}
              <a href="{% url 'organizacao_completo' proposta.organizacao.id %}">
                {{ proposta.organizacao.nome }}
              </a>
            {% elif proposta.nome_organizacao %}
              {{ proposta.nome_organizacao }}
            {% else %}
              {% lng "Organização não definida" "Organization not defined" %}
            {% endif %}  
          </td>

          <td class="text-center">{% include "tipo_proposta.html" %}</td>

        </tr>

      {% endfor %}
    {% include "tabelas_bottom.html" %}
    
    <script>
      $("#filterEdicao").change(function() {
        var selectedValue = $(this).val();
        var table = $("#PropostasTable").DataTable();
        if (selectedValue === "todas") {
          table.column(1).visible(true);
          table.search("").draw();
        }
      });
    </script>

  </div>
  
  {% include "edicoes_ajax.html" with tabela="Propostas" %}

{% endblock %}